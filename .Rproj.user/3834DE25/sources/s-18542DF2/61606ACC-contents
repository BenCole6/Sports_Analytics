---
title:    |
          | Assessing the Probability of the St. Louis Blues
          | Winning the Stanley Cup
          |
subtitle:   |
            | Three Simulations based on Constant Elo Team Ratings
            |
            | MATH2223 - Sports Analytics
            | Course Project
            |
            |
author: "Ben Cole - s3412349"
# date: "Print Date: `r format(Sys.Date(), '%d/%m/%Y')`"
mainfont: Arial Nova
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    smooth_scroll: true
    collapsed: false
    number_sections: true
    code_folding: hide
    fig_width: 9
    fig_height: 7
---

```{r include=FALSE}

start_time <- Sys.time()

```

<style>
    body .main-container {
        max-width: 1500px;
        margin-right: 50px;
    }
</style>

```{r include=FALSE}

## Libraries

library(pacman)

suppressWarnings(p_load(c("tidyverse",
                          "lubridate",
                          "DT",
                          "janitor",
                          "readxl",
                          "beepr",
                          "knitr",
                          "kableExtra",
                          "scales",
                          "lemon"),
                        install = T, character.only = T))

```

# Abstract

# Introduction

The National Hockey League (hereon NHL) is the North American ice hockey competition held each year across the winter months of the Northern hemisphere. The regular season begins in October and usually ends in April the following year, with the finals playoffs series culminating in the competition for the coveted Stanley Cup usually in June. (NHL, 2019)    

## St. Louis Blues - Underdogs

The St. Louis Blues were the winners of the 2018-2019 Stanley Cup playoffs, winning a 4-3 series against the Boston Bruins. The Blues winning the Stanley Cup was paticularly extraordinary not only because it was the first in their history as a club in the NHL, but also because they faced off against the Bruins have appeared so regularly in the Stanley Cup Playoffs. Since joining the NHL in 1967, the St Louis Blues have contested the Stanley Cup Playoffs only 4 times, whilst the Boston Bruins have made it to the Cup Playoffs 10 times since 1967 (and a total 20 since joining the NHL in 1924). (NHL, 2019)  

What arguably made the St. Louis Blues appearance in the Stanley Cup Finals most incredible was that they ranked last in January of the same season. Sometime between January and April they managed to claw their way to clinching a playoffs appearance. (Bardown, 2019)

## NHL Season and Post-Season Structure

The NHL contained a total of 31 teams in the 2019 season. These 31 teams were split across two conferences, Eastern and Western. Each conference comprised two divisions each; Metropolitan and Atlantic in the Eastern Conference and Central and Pacific in the Western Conference. (NHL, 2019)    

Throughout the regular season each team will play 82 games, which are a mixture of home and away fixtures. As the playing season is approximately 27 weeks, these 82 games average out to be more than three games per week. Therefore, unlike many Australian sporting codes, there are no "rounds" in the NHL but simply game numbers. Further, there is no structure or restriction to which game each team is playing. For example, one team may be playing their 26th game against an opponent that is playing their 23rd. (NHL, 2019)  
If a team wins a game in the regular season they are awarded 2 points for the win. If the game has a tied scoreline at the end of the third 20-minute period it will go into overtime. If the scoreline is still tied at the end of two overtime periods then a shootout is played until a winner is decided. The team that wins by any method, including overtime or shootout, is still awarded 2 points. The team that loses in overtime or shootout is awarded one point. If the game is decided before overtime the losing team will be awarded 0 points. (MacDonald, R, 2018)

```{r echo=FALSE, message=FALSE, warning=FALSE}

season_points <- tibble("Win Type" = c("Not Overtime",
                                       "Overtime or Shootout"),
                        "Winning Team Points" = c(2,2),
                        "Losing Team Points" = c(0,1))

kable_styling(kable(season_points,
                    caption = "Points awarded for different win types in NHL regular season"),
              bootstrap_options = c("striped", "hover"),
              full_width = F)

```

Once the regular season has finished and team standings have been calculated a bracketed finals system is drawn up for the playoffs. The finals playoffs follow a repeating knockout structure that has 3 rounds before reaching the Stanley Cup playoffs. Each conference follows the same structure, so only one will be described as follows:  

### Playoffs Selection

A total of 16 teams from both conferences qualify for the finals playoffs. The top three teams in each division are awarded spots in the playoffs. As there are two divisions in each conference, this results in 6 teams in each conference making it to the finals. A further two spots are awarded to the next two highest ranking teams in the conference that did not make the playoffs. As this is based on standings in the conference overall, it's possible for a division to send two wildcards through to the playoffs.

#### First Round

In the first round the highest-ranked division winner plays the lowest-ranked wildcard entrant. The lesser-ranked division winner then plays the remaining wildcard entrant. Teams ranked second and third within each division play each other. Each pairing is decided by a series of games which is decided when one team wins 4 times. This results in a series length that can be anywhere between 4 (winning 4-0) and 7 (winning 4-3), or the best of 7 games.

#### Second Round

The winners of each of each First Round series then play each other in the second round, keeping within divisions and ignoring wildcards. Again, a best of 7 series is played in each pairing.

#### Conference Round

The winners of each Second Round series face off in the Conference round, which decides the winner of each conference via a best of 7 games series.

#### Stanley Cup

The winners of each Conference Round series play off in the Stanley Cup finals, which are also a best of 7 series.

![As it happened: The 2018-2019 Finals Playoffs Series. Source: https://www.nhl.com/stanley-cup-playoffs](Finals_2019.png)

# Aim

## Research Question

Considering the turn around in the St. Louis Blues' performance within the season and the lengthy multiple finals series, what were the chances that the St. Louis Blues could win the Stanley Cup from their standings at the end of the regular season? Further, did this chance considerably from their standings at the end of their 25th and 50th games?

## Overview of Methods

To answer the above questions, Monte Carlo simulations were performed to simulate the season based on Elo ratings at different points in time. These partitions in the data were set at 25 games, 50 games, and the end of the regular season of 82 games.

# Literature Review

## Elo Rating Models

### Predictive Model Overview

Elo Models have a long history for rating teams and players in sport. The first application for Elo models was in rating chess players as applied in the text "*The rating of chessplayers, past and present*" written by Arpad Elo (Elo, 1978). A relatively simple model, it takes the "strength" of each competitor and creates an expected probability of the team winning. The probability domain ranges between 0 and 1, and so by extension the competitor's probability of winning is $ 1-E_A$. Elo models can either be adaptive to be used as a season progresses or can be constant based on game results of historical data. The constant Elo method for rating teams uses optimisation methods to minimise errors when predicting results of past matches.    

### Past Applications

Elo ratings have had a range of applications in sports ratings, with one example being Hvattum, L.M. and Arntzen, H. (2010) applying it association football (soccer). In their paper they applied a variable Elo rating system that incorporated a home ground advantage. They used this variable Elo rating method in logit regression models, which were then used to place hypothetical bets. After evaluation and benchmarking against other methods, they found the models based on Elo ratings to perform better than all other models. The only exceptions to this were models based on betting market information. Further,r they found the variable Elo rating methods to be significant predictors of actual game results, which further solidifies their applications outside of academia.

Ryall, R. and Bedford, A. (2010) also applied optimised Elo ratings models to another sporting code: Australian Rules Football (AFL). Their addition to the model examined home ground advantage of each game, if present. The home ground advantage was incorporated into the Elo prediction model by way of stacking the rating of a home team higher for when they were playing to a home ground advantage. They found adding a home ground advantage did not improve the Elo rating system as compared to previous work by Stefani and Clarke (1992), but cited the low variation in team premiership points as a potentially confounding factor.

## Monte Carlo Simulation

### Overview

Monte Carlo simulations are simple in their structure, which lends them to large iteration chains. A random number generator is used to generate a number between a defined interval, usually $(0<x<1)$. This number is then compared to an expected value. If the expected value is binary, say a coin flip, any number lesser than 0.5 is rounded to 0 and any number greater than or equal to 0.5 is rounded to 1. The distribution of the random number generator can also be chosen, and a uniform distribution with equal probability between any given points in the interval is most common. This process is repeated several times to simulate thousands of observations. (Theodore & Prochaska, 2018)

# Methods

## Optimised Elo Ratings

A constant Elo rating method was used in this study. To determine the optimised Elo ratings of each team in the NHL, the below formula was used to estimate the expected results of each game.

$$ E_A = \frac{1}{1+10^{\left(- \left(\frac{\left(Rating_A - Rating_B \right)}{\delta} \right) \right)}} $$

For each given game, the errors were calculated between the Expected result and the actual result of the match. Different ratings for each team were optimised by minimising the sum of the squares of the errors. The only constraints on the optimisation were that the team ratings averaged 1500 so as to allow for $ \delta=400$.

## Data Partitions

Data was partitioned at three points:
1. Matches where both teams played no more than 25 games
2. Matches where both teams played no more than 50 games
3. No partition, so where teams had played no more than the full 82 games of the season

The first partition was based on the ladder position of the St. Louis Blues after that game number; their lowest point in the season and ranked 30 out of total 31 teams in the League.  
The second partition was chosen arbitrarily. The rationale was for the partition to be twice as many games as the first partition and approximately 2/3^{rds} of the regular season.  
The last partition, or no partition at all, was chosen to examine the St. Louis Blues' chances of winning the Stanley Cup after their final standing in the season.

## Monte Carlo Simulation

### Regular Season

During the regular seasons for partitions 25 and 50, games from 26 and 51 onwards (respectively) were simulated using Monte Carlo methods. A uniform distribution between 0 and 1 was used and compared to the expected results. If the expected result, from Team A's perspective, was greater than the random number a win was recorded, with the winning team earning 2 points to their standings. If the expected result was lesser than the random number by no more than 5 percent, an overtime loss was recorded for Team A and they were awarded 1 point. If the expected result was more than 5% lesser than the random number, a regular loss was recorded and Team A awarded 0 points to their standings.


$$ Points_{A\ |\ \left(E_A > RNG \right)}=2 $$

$$ Points_{A\ |\ \left(E_A < \left(RNG \times 0.95\right) \right)}=0 $$

$$ Points_{A\ |\ \left(\left(E_A < RNG \right)\ \&\ E_A > \left(RNG \times 0.95 \right) \right)}=1 $$

### Finals Playoffs

The above points system using overtime losses was not used in each stage of the finals playoffs. The model was simplified to only compare the expected results to the random number, and any expected result greater than the random number was recorded as a win to Team A.

$$ Points_{A\ |\ E_A<RNG}=1 $$
$$ Points_B = 1- Points_A $$

The first team to reach 4 wins proceeded to the next round per the finals structure outlined in section 2.2.1 above. This was repeated for each stage in the finals playoffs including the final round, the Stanley Cup playoffs, where the first team to 4 wins was also simulated to be the champion of that iteration in the simulation.  

### Monte Carlo Simulations on Partitioned Data

#### Partitions 25 and 50

The Monte Carlo simulations were performed on the data partitions at games 25 and 50. All games in the regular season were simulated after the partition using constant Elo ratings from games prior to the partition. That is, games 26 to 82 were simulated using Elo ratings optimised on games 1 to 25, and games 51 to 82 were simulated using Elo ratings optimised on games 1 to 50.

#### No Partition: 82 Games

The final simulation did not simulate matches in the regular season but *only* simulated games in the post-season playoffs using Elo ratings optimised on match results for games 1 to 82.

# Results

```{r, collapse=T}

## Cleaning and Data Prep

library(pacman)

p_load(c("tidyverse",
         "readxl",
         "janitor",
         "RPushbullet",
         "beepr",
         "scales"),
       install = T, character.only = T)

Game_Data_26 <- clean_names(read_excel("NHL Season Simulator R.xlsx",
                                       sheet = 1),
                            "parsed")

Game_Data_51 <- clean_names(read_excel("NHL Season Simulator R.xlsx",
                                       sheet = 2),
                            "parsed")

Game_Data_82 <- clean_names(read_excel("NHL Season Simulator R.xlsx",
                                       sheet = 3),
                            "parsed")

Game_Data_Finals <- clean_names(read_excel("NHL Season Simulator R.xlsx",
                                           sheet = 4),
                                "parsed")

Elo_25 <- read_excel("NHL Elo Ratings.xlsx",
                     sheet = 1)

Elo_50 <- read_excel("NHL Elo Ratings.xlsx",
                     sheet = 2)

Elo_82 <- read_excel("NHL Elo Ratings.xlsx",
                         sheet = 3)

## Elo for 26

Game_Data_26 <- left_join(x = Game_Data_26,
                          y = Elo_25,
                          by = c("Team_A" = "Team"))

Game_Data_26 <- rename(Game_Data_26, 
                       Rating_A = Rating)

Game_Data_26 <- left_join(x = Game_Data_26,
                          y = Elo_25,
                          by = c("Team_B" = "Team"))

Game_Data_26 <- rename(Game_Data_26,
                       Rating_B = Rating)

Game_Data_26 <- mutate(Game_Data_26,
                       "Expected" = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))))

## Elo for 51

Game_Data_51 <- left_join(x = Game_Data_51,
                          y = Elo_50,
                          by = c("Team_A" = "Team"))

Game_Data_51 <- rename(Game_Data_51, 
                       Rating_A = Rating)

Game_Data_51 <- left_join(x = Game_Data_51,
                          y = Elo_50,
                          by = c("Team_B" = "Team"))

Game_Data_51 <- rename(Game_Data_51,
                       Rating_B = Rating)

Game_Data_51 <- mutate(Game_Data_51,
                       "Expected" = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))))

## Elo for 82

Game_Data_82 <- left_join(x = Game_Data_82,
                          y = Elo_82,
                          by = c("Team_A" = "Team"))

Game_Data_82 <- rename(Game_Data_82, 
                       Rating_A = Rating)

Game_Data_82 <- left_join(x = Game_Data_82,
                          y = Elo_82,
                          by = c("Team_B" = "Team"))

Game_Data_82 <- rename(Game_Data_82,
                       Rating_B = Rating)

Game_Data_82 <- mutate(Game_Data_82,
                       "Expected" = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))))

```


```{r, message=FALSE, warning=FALSE}

## Season Simulator for Partition 25

Game_Data_26$RNG <- NA
Game_Data_26$Points_A <- NA
Game_Data_26$Points_B <- NA

Conferences_Divisions <- select(Game_Data_Finals,
                                Team = Team_A,
                                Division,
                                Conference)

Game_Data_26 <- left_join(Game_Data_26,
                          Conferences_Divisions,
                          by = c("Team_A" = "Team"))

Game_Data_26 <- rename(Game_Data_26,
                       Division_A = Division,
                       Conference_A = Conference)

Game_Data_26 <- left_join(Game_Data_26,
                          Conferences_Divisions,
                          by = c("Team_B" = "Team"))

Game_Data_26 <- rename(Game_Data_26,
                       Division_B = Division,
                       Conference_B = Conference)

Game_Monte_26 <- Game_Data_26

Monte_Results_26 <- data.frame()
Monte_Results_First_Round_26 <- data.frame()
Monte_Results_Second_Round_26 <- data.frame()
Monte_Results_Conf_Round_26 <- data.frame()
Monte_Results_Stanley_Round_26 <- data.frame()
Monte_Results_Stanley_Round_Winner_26 <- data.frame()

Start_Time <- Sys.time()

for (sim_no in 1:2500) {
  
  for (j in 1:nrow(Game_Monte_26)) {
    
    Game_Monte_26$RNG[j] <- runif(n = 1, min = 0, max = 1)
    
    Game_Monte_26$Points_A[j] <- if_else(Game_Monte_26$Expected[j] >= Game_Monte_26$RNG[j] * 0.95 &
                                        Game_Monte_26$Expected[j] <= Game_Monte_26$RNG[j],
                                      true = 1,
                                      false = if_else(Game_Monte_26$Expected[j] > Game_Monte_26$RNG[j],
                                                      true = 2,
                                                      false = 0))
    
    Game_Monte_26$Points_B[j] <- if_else(Game_Monte_26$Expected[j] <= Game_Monte_26$RNG[j] * 0.95 &
                                        Game_Monte_26$Expected[j] >= Game_Monte_26$RNG[j],
                                      true = 1,
                                      false = if_else(Game_Monte_26$Expected[j] < Game_Monte_26$RNG[j],
                                                      true = 2,
                                                      false = 0))
    
    
    
  }
  
  Game_Monte_Long <- gather(Game_Monte_26,
                            Team_A, Team_B,
                            key = "Team_Order",
                            value = "Team_Name")
  
  Game_Monte_Sum <- summarise(group_by(Game_Monte_Long,
                                       Team_Name),
                              Points = sum(Points_A[Team_Order == "Team_A"] +
                                             Points_B[Team_Order == "Team_B"]))
  
  Game_Monte_Sum <- left_join(x = Game_Monte_Sum,
                              y = Elo_25,
                              by = c("Team_Name" = "Team"))
  
  Game_Monte_Sum <- mutate(Game_Monte_Sum,
                           Adjusted_Points = Points + Rating/10000)
  
  Game_Monte_Sum <- mutate(ungroup(Game_Monte_Sum),
                           Position = rank(-Adjusted_Points, "min"),
                           Sim_No = sim_no)
  
  Game_Monte_Sum <- left_join(Game_Monte_Sum,
                              Conferences_Divisions,
                              by = c("Team_Name" = "Team"))
  
  Game_Monte_Sum <- mutate(group_by(Game_Monte_Sum,
                                    Division),
                           Position_in_Div = rank(-Adjusted_Points))
  
  Game_Monte_Sum <- mutate(group_by(Game_Monte_Sum,
                                    Conference),
                           Position_in_Conf = rank(-Adjusted_Points))
  
  Finals <- filter(Game_Monte_Sum,
                   Position_in_Div <= 3)
  
  Wildcards <- filter(Game_Monte_Sum,
                      !(Team_Name %in% Finals$Team_Name))
  
  Wildcards <- mutate(Wildcards,
                      "Wildcard_Rank" = rank(-Position_in_Conf))
  
  Finals <- rbind(Finals,
                  filter(Wildcards,
                         Wildcard_Rank <= 2))
  
  ## First Round 1
  First_Round_26_1 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Atlantic",
                          Position_in_Div == 1)
  
  First_Round_26_1 <- bind_rows(First_Round_26_1,
                             filter(Finals,
                                    Conference == "Eastern",
                                    Wildcard_Rank == 1))
  
  First_Round_26_1 <- transmute(First_Round_26_1,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_26_1 <- mutate(First_Round_26_1,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_26_1[nrow(First_Round_26_1) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_26_1[nrow(First_Round_26_1) , "Won_A"] <- if_else(First_Round_26_1[nrow(First_Round_26_1) , "Rand"] <= 
                                                                First_Round_26_1[nrow(First_Round_26_1) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_26_1[nrow(First_Round_26_1) , "Won_B"] <- 1 - First_Round_26_1[ , "Won_A"]
      
    }
    
    if (sum(First_Round_26_1[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_26_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_26_1[nrow(First_Round_26_1)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_26_1[nrow(First_Round_26_1) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_26_1[nrow(First_Round_26_1) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_26_1[nrow(First_Round_26_1) , "Won_A"] <- if_else(First_Round_26_1[nrow(First_Round_26_1) , "Rand"] <= 
                                                                First_Round_26_1[nrow(First_Round_26_1) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_26_1[nrow(First_Round_26_1) , "Won_B"] <- 1 - First_Round_26_1[ nrow(First_Round_26_1) , "Won_A"]
      
    }
    
    First_Round_26_1_Winner <- summarise(First_Round_26_1,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_26_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_26_1_Winner <- select(First_Round_26_1,
                                   contains(Winner_Suffix))
    
    First_Round_26_1_Winner <- First_Round_26_1_Winner[nrow(First_Round_26_1_Winner), ]
    
    colnames(First_Round_26_1_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 2
  First_Round_26_2 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Atlantic",
                          Position_in_Div == 2)
  
  First_Round_26_2 <- bind_rows(First_Round_26_2,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Division == "Atlantic",
                                    Position_in_Div == 3))
  
  First_Round_26_2 <- transmute(First_Round_26_2,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_26_2 <- mutate(First_Round_26_2,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_26_2[nrow(First_Round_26_2) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_26_2[nrow(First_Round_26_2) , "Won_A"] <- if_else(First_Round_26_2[nrow(First_Round_26_2) , "Rand"] <= 
                                                                First_Round_26_2[nrow(First_Round_26_2) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_26_2[nrow(First_Round_26_2) , "Won_B"] <- 1 - First_Round_26_2[ , "Won_A"]
      
    }
    
    if (sum(First_Round_26_2[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_26_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_26_2[nrow(First_Round_26_2)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_26_2[nrow(First_Round_26_2) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_26_2[nrow(First_Round_26_2) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_26_2[nrow(First_Round_26_2) , "Won_A"] <- if_else(First_Round_26_2[nrow(First_Round_26_2) , "Rand"] <= 
                                                                First_Round_26_2[nrow(First_Round_26_2) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_26_2[nrow(First_Round_26_2) , "Won_B"] <- 1 - First_Round_26_2[ nrow(First_Round_26_2) , "Won_A"]
      
    }
    
    First_Round_26_2_Winner <- summarise(First_Round_26_2,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_26_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_26_2_Winner <- select(First_Round_26_2,
                                   contains(Winner_Suffix))
    
    First_Round_26_2_Winner <- First_Round_26_2_Winner[nrow(First_Round_26_2_Winner), ]
    
    colnames(First_Round_26_2_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 3
  First_Round_26_3 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Metropolitan",
                          Position_in_Div == 1)
  
  First_Round_26_3 <- bind_rows(First_Round_26_3,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Wildcard_Rank == 2))
  
  First_Round_26_3 <- transmute(First_Round_26_3,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_26_3 <- mutate(First_Round_26_3,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_26_3[nrow(First_Round_26_3) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_26_3[nrow(First_Round_26_3) , "Won_A"] <- if_else(First_Round_26_3[nrow(First_Round_26_3) , "Rand"] <= 
                                                                First_Round_26_3[nrow(First_Round_26_3) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_3[nrow(First_Round_3) , "Won_B"] <- 1 - First_Round_3[ , "Won_A"]
      
    }
    
    if (sum(First_Round_3[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_3[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_3[nrow(First_Round_3)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_3[nrow(First_Round_3) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_3[nrow(First_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_3[nrow(First_Round_3) , "Won_A"] <- if_else(First_Round_3[nrow(First_Round_3) , "Rand"] <= 
                                                                First_Round_3[nrow(First_Round_3) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_3[nrow(First_Round_3) , "Won_B"] <- 1 - First_Round_3[ nrow(First_Round_3) , "Won_A"]
      
    }
    
    First_Round_3_Winner <- summarise(First_Round_3,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_3_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_3_Winner <- select(First_Round_3,
                                   contains(Winner_Suffix))
    
    First_Round_3_Winner <- First_Round_3_Winner[nrow(First_Round_3_Winner), ]
    
    colnames(First_Round_3_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 4
  First_Round_4 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Metropolitan",
                          Position_in_Div == 2)
  
  First_Round_4 <- bind_rows(First_Round_4,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Division == "Metropolitan",
                                    Position_in_Div == 3))
  
  First_Round_4 <- transmute(First_Round_4,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_4 <- mutate(First_Round_4,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_4[nrow(First_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_4[nrow(First_Round_4) , "Won_A"] <- if_else(First_Round_4[nrow(First_Round_4) , "Rand"] <= 
                                                                First_Round_4[nrow(First_Round_4) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_4[nrow(First_Round_4) , "Won_B"] <- 1 - First_Round_4[ , "Won_A"]
      
    }
    
    if (sum(First_Round_4[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_4[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_4[nrow(First_Round_4)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_4[nrow(First_Round_4) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_4[nrow(First_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_4[nrow(First_Round_4) , "Won_A"] <- if_else(First_Round_4[nrow(First_Round_4) , "Rand"] <= 
                                                                First_Round_4[nrow(First_Round_4) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_4[nrow(First_Round_4) , "Won_B"] <- 1 - First_Round_4[ nrow(First_Round_4) , "Won_A"]
      
    }
    
    First_Round_4_Winner <- summarise(First_Round_4,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_4_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_4_Winner <- select(First_Round_4,
                                   contains(Winner_Suffix))
    
    First_Round_4_Winner <- First_Round_4_Winner[nrow(First_Round_4_Winner), ]
    
    colnames(First_Round_4_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 5
  First_Round_5 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Central",
                          Position_in_Div == 1)
  
  First_Round_5 <- bind_rows(First_Round_5,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Wildcard_Rank == 1))
  
  First_Round_5 <- transmute(First_Round_5,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_5 <- mutate(First_Round_5,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_5[nrow(First_Round_5) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_5[nrow(First_Round_5) , "Won_A"] <- if_else(First_Round_5[nrow(First_Round_5) , "Rand"] <= 
                                                                First_Round_5[nrow(First_Round_5) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_5[nrow(First_Round_5) , "Won_B"] <- 1 - First_Round_5[ , "Won_A"]
      
    }
    
    if (sum(First_Round_5[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_5[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_5[nrow(First_Round_5)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_5[nrow(First_Round_5) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_5[nrow(First_Round_5) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_5[nrow(First_Round_5) , "Won_A"] <- if_else(First_Round_5[nrow(First_Round_5) , "Rand"] <= 
                                                                First_Round_5[nrow(First_Round_5) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_5[nrow(First_Round_5) , "Won_B"] <- 1 - First_Round_5[ nrow(First_Round_5) , "Won_A"]
      
    }
    
    First_Round_5_Winner <- summarise(First_Round_5,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_5_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_5_Winner <- select(First_Round_5,
                                   contains(Winner_Suffix))
    
    First_Round_5_Winner <- First_Round_5_Winner[nrow(First_Round_5_Winner), ]
    
    colnames(First_Round_5_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 6
  First_Round_6 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Central",
                          Position_in_Div == 2)
  
  First_Round_6 <- bind_rows(First_Round_6,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Division == "Central",
                                    Position_in_Div == 3))
  
  First_Round_6 <- transmute(First_Round_6,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_6 <- mutate(First_Round_6,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_6[nrow(First_Round_6) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_6[nrow(First_Round_6) , "Won_A"] <- if_else(First_Round_6[nrow(First_Round_6) , "Rand"] <= 
                                                                First_Round_6[nrow(First_Round_6) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_6[nrow(First_Round_6) , "Won_B"] <- 1 - First_Round_6[ , "Won_A"]
      
    }
    
    if (sum(First_Round_6[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_6[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_6[nrow(First_Round_6)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_6[nrow(First_Round_6) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_6[nrow(First_Round_6) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_6[nrow(First_Round_6) , "Won_A"] <- if_else(First_Round_6[nrow(First_Round_6) , "Rand"] <= 
                                                                First_Round_6[nrow(First_Round_6) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_6[nrow(First_Round_6) , "Won_B"] <- 1 - First_Round_6[ nrow(First_Round_6) , "Won_A"]
      
    }
    
    First_Round_6_Winner <- summarise(First_Round_6,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_6_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_6_Winner <- select(First_Round_6,
                                   contains(Winner_Suffix))
    
    First_Round_6_Winner <- First_Round_6_Winner[nrow(First_Round_6_Winner), ]
    
    colnames(First_Round_6_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 7
  First_Round_7 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Pacific",
                          Position_in_Div == 1)
  
  First_Round_7 <- bind_rows(First_Round_7,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Wildcard_Rank == 2))
  
  First_Round_7 <- transmute(First_Round_7,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_7 <- mutate(First_Round_7,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_7[nrow(First_Round_7) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_7[nrow(First_Round_7) , "Won_A"] <- if_else(First_Round_7[nrow(First_Round_7) , "Rand"] <= 
                                                                First_Round_7[nrow(First_Round_7) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_7[nrow(First_Round_7) , "Won_B"] <- 1 - First_Round_7[ , "Won_A"]
      
    }
    
    if (sum(First_Round_7[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_7[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_7[nrow(First_Round_7)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_7[nrow(First_Round_7) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_7[nrow(First_Round_7) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_7[nrow(First_Round_7) , "Won_A"] <- if_else(First_Round_7[nrow(First_Round_7) , "Rand"] <= 
                                                                First_Round_7[nrow(First_Round_7) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_7[nrow(First_Round_7) , "Won_B"] <- 1 - First_Round_7[ nrow(First_Round_7) , "Won_A"]
      
    }
    
    First_Round_7_Winner <- summarise(First_Round_7,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_7_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_7_Winner <- select(First_Round_7,
                                   contains(Winner_Suffix))
    
    First_Round_7_Winner <- First_Round_7_Winner[nrow(First_Round_7_Winner), ]
    
    colnames(First_Round_7_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 8
  First_Round_8 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Pacific",
                          Position_in_Div == 2)
  
  First_Round_8 <- bind_rows(First_Round_8,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Division == "Pacific",
                                    Position_in_Div == 3))
  
  First_Round_8 <- transmute(First_Round_8,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_8 <- mutate(First_Round_8,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_8[nrow(First_Round_8) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_8[nrow(First_Round_8) , "Won_A"] <- if_else(First_Round_8[nrow(First_Round_8) , "Rand"] <= 
                                                                First_Round_8[nrow(First_Round_8) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_8[nrow(First_Round_8) , "Won_B"] <- 1 - First_Round_8[ , "Won_A"]
      
    }
    
    if (sum(First_Round_8[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_8[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_8[nrow(First_Round_8)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_8[nrow(First_Round_8) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_8[nrow(First_Round_8) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_8[nrow(First_Round_8) , "Won_A"] <- if_else(First_Round_8[nrow(First_Round_8) , "Rand"] <= 
                                                                First_Round_8[nrow(First_Round_8) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_8[nrow(First_Round_8) , "Won_B"] <- 1 - First_Round_8[ nrow(First_Round_8) , "Won_A"]
      
    }
    
    First_Round_8_Winner <- summarise(First_Round_8,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_8_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_8_Winner <- select(First_Round_8,
                                   contains(Winner_Suffix))
    
    First_Round_8_Winner <- First_Round_8_Winner[nrow(First_Round_8_Winner), ]
    
    colnames(First_Round_8_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ### Second Round
  
  ## Second_Round_1
  
  Second_Round_1 <- rbind(First_Round_1_Winner,
                          First_Round_2_Winner)
  
  Second_Round_1[ , "Won"] <- NA
  
  Second_Round_1 <- transmute(Second_Round_1,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_1 <- mutate(Second_Round_1,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_1[nrow(Second_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_A"] <- if_else(Second_Round_1[nrow(Second_Round_1) , "Rand"] <= 
                                                                  Second_Round_1[nrow(Second_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_B"] <- 1 - Second_Round_1[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_1[nrow(Second_Round_1)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_1[nrow(Second_Round_1) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_1[nrow(Second_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_A"] <- if_else(Second_Round_1[nrow(Second_Round_1) , "Rand"] <= 
                                                                  Second_Round_1[nrow(Second_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_B"] <- 1 - Second_Round_1[ nrow(Second_Round_1) , "Won_A"]
      
    }
    
    Second_Round_1_Winner <- summarise(Second_Round_1,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_1_Winner <- select(Second_Round_1,
                                    contains(Winner_Suffix))
    
    Second_Round_1_Winner <- Second_Round_1_Winner[nrow(Second_Round_1_Winner), ]
    
    colnames(Second_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  
  ## Second_Round_2
  
  Second_Round_2 <- rbind(First_Round_3_Winner,
                          First_Round_4_Winner)
  
  Second_Round_2[ , "Won"] <- NA
  
  Second_Round_2 <- transmute(Second_Round_2,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_2 <- mutate(Second_Round_2,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_2[nrow(Second_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_A"] <- if_else(Second_Round_2[nrow(Second_Round_2) , "Rand"] <= 
                                                                  Second_Round_2[nrow(Second_Round_2) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_B"] <- 1 - Second_Round_2[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_2[nrow(Second_Round_2)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_2[nrow(Second_Round_2) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_2[nrow(Second_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_A"] <- if_else(Second_Round_2[nrow(Second_Round_2) , "Rand"] <= 
                                                                  Second_Round_2[nrow(Second_Round_2) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_B"] <- 1 - Second_Round_2[ nrow(Second_Round_2) , "Won_A"]
      
    }
    
    Second_Round_2_Winner <- summarise(Second_Round_2,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_2_Winner <- select(Second_Round_2,
                                    contains(Winner_Suffix))
    
    Second_Round_2_Winner <- Second_Round_2_Winner[nrow(Second_Round_2_Winner), ]
    
    colnames(Second_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Second_Round_3
  
  Second_Round_3 <- rbind(First_Round_5_Winner,
                          First_Round_6_Winner)
  
  Second_Round_3[ , "Won"] <- NA
  
  Second_Round_3 <- transmute(Second_Round_3,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_3 <- mutate(Second_Round_3,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_3[nrow(Second_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_A"] <- if_else(Second_Round_3[nrow(Second_Round_3) , "Rand"] <= 
                                                                  Second_Round_3[nrow(Second_Round_3) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_B"] <- 1 - Second_Round_3[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_3[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_3[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_3[nrow(Second_Round_3)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_3[nrow(Second_Round_3) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_3[nrow(Second_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_A"] <- if_else(Second_Round_3[nrow(Second_Round_3) , "Rand"] <= 
                                                                  Second_Round_3[nrow(Second_Round_3) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_B"] <- 1 - Second_Round_3[ nrow(Second_Round_3) , "Won_A"]
      
    }
    
    Second_Round_3_Winner <- summarise(Second_Round_3,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_3_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_3_Winner <- select(Second_Round_3,
                                    contains(Winner_Suffix))
    
    Second_Round_3_Winner <- Second_Round_3_Winner[nrow(Second_Round_3_Winner), ]
    
    colnames(Second_Round_3_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Second_Round_4
  
  Second_Round_4 <- rbind(First_Round_7_Winner,
                          First_Round_8_Winner)
  
  Second_Round_4[ , "Won"] <- NA
  
  Second_Round_4 <- transmute(Second_Round_4,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_4 <- mutate(Second_Round_4,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_4[nrow(Second_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_A"] <- if_else(Second_Round_4[nrow(Second_Round_4) , "Rand"] <= 
                                                                  Second_Round_4[nrow(Second_Round_4) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_B"] <- 1 - Second_Round_4[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_4[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_4[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_4[nrow(Second_Round_4)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_4[nrow(Second_Round_4) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_4[nrow(Second_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_A"] <- if_else(Second_Round_4[nrow(Second_Round_4) , "Rand"] <= 
                                                                  Second_Round_4[nrow(Second_Round_4) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_B"] <- 1 - Second_Round_4[ nrow(Second_Round_4) , "Won_A"]
      
    }
    
    Second_Round_4_Winner <- summarise(Second_Round_4,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_4_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_4_Winner <- select(Second_Round_4,
                                    contains(Winner_Suffix))
    
    Second_Round_4_Winner <- Second_Round_4_Winner[nrow(Second_Round_4_Winner), ]
    
    colnames(Second_Round_4_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ### Conference Round
  
  ## Conference_Round_1
  
  Conf_Round_1 <- rbind(Second_Round_1_Winner,
                        Second_Round_2_Winner)
  
  Conf_Round_1[ , "Won"] <- NA
  
  Conf_Round_1 <- transmute(Conf_Round_1,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Conf_Round_1 <- mutate(Conf_Round_1,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_A"] <- if_else(Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <= 
                                                                  Conf_Round_1[nrow(Conf_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_B"] <- 1 - Conf_Round_1[ , "Won_A"]
      
    }
    
    if (sum(Conf_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(Conf_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Conf_Round_1[nrow(Conf_Round_1)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Conf_Round_1[nrow(Conf_Round_1) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_A"] <- if_else(Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <= 
                                                                  Conf_Round_1[nrow(Conf_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_B"] <- 1 - Conf_Round_1[ nrow(Conf_Round_1) , "Won_A"]
      
    }
    
    Conf_Round_1_Winner <- summarise(Conf_Round_1,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Conf_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Conf_Round_1_Winner <- select(Conf_Round_1,
                                    contains(Winner_Suffix))
    
    Conf_Round_1_Winner <- Conf_Round_1_Winner[nrow(Conf_Round_1_Winner), ]
    
    colnames(Conf_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Conference_Round_2
  
  Conf_Round_2 <- rbind(Second_Round_3_Winner,
                        Second_Round_4_Winner)
  
  Conf_Round_2[ , "Won"] <- NA
  
  Conf_Round_2 <- transmute(Conf_Round_2,
                            Team_A = Team[1],
                            Team_B = Team[2],
                            Rating_A = Rating[1],
                            Rating_B = Rating[2],
                            Conference_A = Conference[1],
                            Conference_B = Conference[2])[1 , ]
  
  Conf_Round_2 <- mutate(Conf_Round_2,
                         Expected = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))),
                         "Rand" = NA,
                         "Won_A" = NA,
                         "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_A"] <- if_else(Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <= 
                                                              Conf_Round_2[nrow(Conf_Round_2) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_B"] <- 1 - Conf_Round_2[ , "Won_A"]
      
    }
    
    if (sum(Conf_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(Conf_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Conf_Round_2[nrow(Conf_Round_2)+1 , c("Team_A",
                                            "Team_B",
                                            "Rating_A",
                                            "Rating_B",
                                            "Conference_A",
                                            "Conference_B",
                                            "Expected")] <- Conf_Round_2[nrow(Conf_Round_2) , c("Team_A",
                                                                                                "Team_B",
                                                                                                "Rating_A",
                                                                                                "Rating_B",
                                                                                                "Conference_A",
                                                                                                "Conference_B",
                                                                                                "Expected")]
      
      Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_A"] <- if_else(Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <= 
                                                              Conf_Round_2[nrow(Conf_Round_2) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_B"] <- 1 - Conf_Round_2[ nrow(Conf_Round_2) , "Won_A"]
      
    }
    
    Conf_Round_2_Winner <- summarise(Conf_Round_2,
                                     "Wins_A" = sum(Won_A),
                                     "Wins_B" = sum(Won_B),
                                     "Winner" = if_else(Wins_A == 4,
                                                        "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Conf_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Conf_Round_2_Winner <- select(Conf_Round_2,
                                  contains(Winner_Suffix))
    
    Conf_Round_2_Winner <- Conf_Round_2_Winner[nrow(Conf_Round_2_Winner), ]
    
    colnames(Conf_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Conference_Round_1
  
  Stanley_Cup_Round <- rbind(Conf_Round_1_Winner,
                             Conf_Round_2_Winner)
  
  Stanley_Cup_Round[ , "Won"] <- NA
  
  Stanley_Cup_Round <- transmute(Stanley_Cup_Round,
                            Team_A = Team[1],
                            Team_B = Team[2],
                            Rating_A = Rating[1],
                            Rating_B = Rating[2],
                            Conference_A = Conference[1],
                            Conference_B = Conference[2])[1 , ]
  
  Stanley_Cup_Round <- mutate(Stanley_Cup_Round,
                         Expected = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))),
                         "Rand" = NA,
                         "Won_A" = NA,
                         "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <- runif(1, 0, 1)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_A"] <- if_else(Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <= 
                                                              Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_B"] <- 1 - Stanley_Cup_Round[ , "Won_A"]
      
    }
    
    if (sum(Stanley_Cup_Round[ , "Won_A"], na.rm = T) == 4 || sum(Stanley_Cup_Round[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round)+1 , c("Team_A",
                                            "Team_B",
                                            "Rating_A",
                                            "Rating_B",
                                            "Conference_A",
                                            "Conference_B",
                                            "Expected")] <- Stanley_Cup_Round[nrow(Stanley_Cup_Round) , c("Team_A",
                                                                                                "Team_B",
                                                                                                "Rating_A",
                                                                                                "Rating_B",
                                                                                                "Conference_A",
                                                                                                "Conference_B",
                                                                                                "Expected")]
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <- runif(1, 0, 1)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_A"] <- if_else(Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <= 
                                                              Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_B"] <- 1 - Stanley_Cup_Round[ nrow(Stanley_Cup_Round) , "Won_A"]
      
    }
    
    Stanley_Cup_Round <- mutate(Stanley_Cup_Round,
                                Sim_No = sim_no)
    
    Stanley_Cup_Round_Winner <- summarise(Stanley_Cup_Round,
                                     "Wins_A" = sum(Won_A),
                                     "Wins_B" = sum(Won_B),
                                     "Winner" = if_else(Wins_A == 4,
                                                        "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Stanley_Cup_Round_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Stanley_Cup_Round_Winner <- select(Stanley_Cup_Round,
                                       contains(Winner_Suffix))
    
    Stanley_Cup_Round_Winner <- Stanley_Cup_Round_Winner[nrow(Stanley_Cup_Round_Winner), ]
    
    Stanley_Cup_Round_Winner <- mutate(Stanley_Cup_Round_Winner,
                                       Sim_No = sim_no)
    
    colnames(Stanley_Cup_Round_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  Monte_Results_26 <- rbind(Monte_Results_26,
                                ungroup(Game_Monte_Sum))
  
  for (round_ind in ls()[which(str_detect(ls(), "First_Round_26\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_First_Round_26 <- rbind(Monte_Results_First_Round_26,
                                     First_Round_26_1,
                                     First_Round_26_2,
                                     First_Round_26_3,
                                     First_Round_26_4,
                                     First_Round_26_5,
                                     First_Round_26_6,
                                     First_Round_26_7,
                                     First_Round_26_8)
  
  for (round_ind in ls()[which(str_detect(ls(), "Second_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_Second_Round_26 <- rbind(Monte_Results_Second_Round_26,
                                      Second_Round_1,
                                      Second_Round_2,
                                      Second_Round_3,
                                      Second_Round_4)
  
  for (round_ind in ls()[which(str_detect(ls(), "Conf_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_Conf_Round_26 <- rbind(Monte_Results_Conf_Round_26,
                                    Conf_Round_1,
                                    Conf_Round_2)
  
  Monte_Results_Stanley_Round_26 <- rbind(Monte_Results_Stanley_Round_26,
                                       Stanley_Cup_Round)
  
  Monte_Results_Stanley_Round_Winner_26 <- rbind(Monte_Results_Stanley_Round_Winner_26,
                                              Stanley_Cup_Round_Winner)
  
}

```

```{r, fig.height=9}

ggplot(Monte_Results_26,
       aes(x = Position)) +
  geom_density(fill = "cyan2",
                alpha = 0.25) +
  facet_rep_wrap( ~ Team_Name,
                  repeat.tick.labels = T,
                  nrow = 4) +
  ggtitle(label = paste("Probability Density of Each Team's Finishing Standing in the NHL",
                        "Across", comma(sim_no), "Trials"),
          subtitle = "Using the Elo 25 Partition") +
  theme_minimal()

```

```{r}

St_Louis_Results <- filter(summarise(group_by(Monte_Results_26,
                                              Team_Name, Position),
                                     "Count" = n()),
                           Team_Name == "St. Louis Blues")

ggplot(St_Louis_Results,
       aes(x = Position, y = Count)) +
  geom_bar(stat = "identity",
           col = "yellow",
           fill = "blue3") +
  ggtitle(label = paste("Frequencies of Finishing Position for St. Louis Blues Across",
                        comma(sim_no), "Trials"),
          subtitle = "Using the Elo 25 Partition") +
  scale_x_continuous(breaks = seq(1,31,2)) +
  scale_y_continuous("Number of Trials in Finishing Position") +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank())

ggplot(Monte_Results_Stanley_Round_Winner_26) +
  geom_bar(aes(x = Team),
           fill = "cyan",
           alpha = 0.5) +
  geom_text(aes(x = Team,
                y = ..count..,
                label = ..count..,
                hjust = -0.25),
            stat = "count") +
  scale_x_discrete("Team",
                   limits = rev(levels(as.factor(Monte_Results_Stanley_Round_Winner_26$Team)))) +
  scale_y_continuous("Number of Stanley Cup Wins",
                     labels = comma) +
  theme_minimal() +
  ggtitle(label = paste("Stanley Cup Winning Teams in",
                        comma(sim_no),
                        "Trials"),
          subtitle = "Using Elo 25 Partition") +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip()

```

```{r, message=FALSE, warning=FALSE}

## Season Simulator for Partition 50

Game_Data_51$RNG <- NA
Game_Data_51$Points_A <- NA
Game_Data_51$Points_B <- NA

Conferences_Divisions_51 <- select(Game_Data_Finals,
                                   Team = Team_A,
                                   Division,
                                   Conference)

Game_Data_51 <- left_join(Game_Data_51,
                          Conferences_Divisions_51,
                          by = c("Team_A" = "Team"))

Game_Data_51 <- rename(Game_Data_51,
                       Division_A = Division,
                       Conference_A = Conference)

Game_Data_51 <- left_join(Game_Data_51,
                          Conferences_Divisions_51,
                          by = c("Team_B" = "Team"))

Game_Data_51 <- rename(Game_Data_51,
                       Division_B = Division,
                       Conference_B = Conference)

Game_Monte_51 <- Game_Data_51

Monte_Results_Season_51 <- data.frame()
Monte_Results_First_Round_51 <- data.frame()
Monte_Results_Second_Round_51 <- data.frame()
Monte_Results_Conf_Round_51 <- data.frame()
Monte_Results_Stanley_Round_51 <- data.frame()
Monte_Results_Stanley_Round_Winner_51 <- data.frame()

Start_Time <- Sys.time()

for (sim_no in 1:2500) {
  
  for (j in 1:nrow(Game_Monte_51)) {
    
    Game_Monte_51$RNG[j] <- runif(n = 1, min = 0, max = 1)
    
    Game_Monte_51$Points_A[j] <- if_else(Game_Monte_51$Expected[j] >= Game_Monte_51$RNG[j] * 0.95 &
                                        Game_Monte_51$Expected[j] <= Game_Monte_51$RNG[j],
                                      true = 1,
                                      false = if_else(Game_Monte_51$Expected[j] > Game_Monte_51$RNG[j],
                                                      true = 2,
                                                      false = 0))
    
    Game_Monte_51$Points_B[j] <- if_else(Game_Monte_51$Expected[j] <= Game_Monte_51$RNG[j] * 0.95 &
                                        Game_Monte_51$Expected[j] >= Game_Monte_51$RNG[j],
                                      true = 1,
                                      false = if_else(Game_Monte_51$Expected[j] < Game_Monte_51$RNG[j],
                                                      true = 2,
                                                      false = 0))
    
    
    
  }
  
  Game_Monte_Long <- gather(Game_Monte_51,
                            Team_A, Team_B,
                            key = "Team_Order",
                            value = "Team_Name")
  
  Game_Monte_Sum <- summarise(group_by(Game_Monte_Long,
                                       Team_Name),
                              Points = sum(Points_A[Team_Order == "Team_A"] +
                                             Points_B[Team_Order == "Team_B"]))
  
  Game_Monte_Sum <- left_join(x = Game_Monte_Sum,
                              y = Elo_50,
                              by = c("Team_Name" = "Team"))
  
  Game_Monte_Sum <- mutate(Game_Monte_Sum,
                           Adjusted_Points = Points + Rating/10000)
  
  Game_Monte_Sum <- mutate(ungroup(Game_Monte_Sum),
                           Position = rank(-Adjusted_Points, "min"),
                           Sim_No = sim_no)
  
  Game_Monte_Sum <- left_join(Game_Monte_Sum,
                              Conferences_Divisions_51,
                              by = c("Team_Name" = "Team"))
  
  Game_Monte_Sum <- mutate(group_by(Game_Monte_Sum,
                                    Division),
                           Position_in_Div = rank(-Adjusted_Points))
  
  Game_Monte_Sum <- mutate(group_by(Game_Monte_Sum,
                                    Conference),
                           Position_in_Conf = rank(-Adjusted_Points))
  
  Finals <- filter(Game_Monte_Sum,
                   Position_in_Div <= 3)
  
  Wildcards <- filter(Game_Monte_Sum,
                      !(Team_Name %in% Finals$Team_Name))
  
  Wildcards <- mutate(Wildcards,
                      "Wildcard_Rank" = rank(-Position_in_Conf))
  
  Finals <- rbind(Finals,
                  filter(Wildcards,
                         Wildcard_Rank <= 2))
  
  ## First Round 1
  First_Round_1 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Atlantic",
                          Position_in_Div == 1)
  
  First_Round_1 <- bind_rows(First_Round_1,
                             filter(Finals,
                                    Conference == "Eastern",
                                    Wildcard_Rank == 1))
  
  First_Round_1 <- transmute(First_Round_1,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_1 <- mutate(First_Round_1,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_1[nrow(First_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_1[nrow(First_Round_1) , "Won_A"] <- if_else(First_Round_1[nrow(First_Round_1) , "Rand"] <= 
                                                                First_Round_1[nrow(First_Round_1) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_1[nrow(First_Round_1) , "Won_B"] <- 1 - First_Round_1[ , "Won_A"]
      
    }
    
    if (sum(First_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_1[nrow(First_Round_1)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_1[nrow(First_Round_1) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_1[nrow(First_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_1[nrow(First_Round_1) , "Won_A"] <- if_else(First_Round_1[nrow(First_Round_1) , "Rand"] <= 
                                                                First_Round_1[nrow(First_Round_1) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_1[nrow(First_Round_1) , "Won_B"] <- 1 - First_Round_1[ nrow(First_Round_1) , "Won_A"]
      
    }
    
    First_Round_1_Winner <- summarise(First_Round_1,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_1_Winner <- select(First_Round_1,
                                   contains(Winner_Suffix))
    
    First_Round_1_Winner <- First_Round_1_Winner[nrow(First_Round_1_Winner), ]
    
    colnames(First_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 2
  First_Round_2 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Atlantic",
                          Position_in_Div == 2)
  
  First_Round_2 <- bind_rows(First_Round_2,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Division == "Atlantic",
                                    Position_in_Div == 3))
  
  First_Round_2 <- transmute(First_Round_2,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_2 <- mutate(First_Round_2,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_2[nrow(First_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_2[nrow(First_Round_2) , "Won_A"] <- if_else(First_Round_2[nrow(First_Round_2) , "Rand"] <= 
                                                                First_Round_2[nrow(First_Round_2) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_2[nrow(First_Round_2) , "Won_B"] <- 1 - First_Round_2[ , "Won_A"]
      
    }
    
    if (sum(First_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_2[nrow(First_Round_2)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_2[nrow(First_Round_2) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_2[nrow(First_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_2[nrow(First_Round_2) , "Won_A"] <- if_else(First_Round_2[nrow(First_Round_2) , "Rand"] <= 
                                                                First_Round_2[nrow(First_Round_2) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_2[nrow(First_Round_2) , "Won_B"] <- 1 - First_Round_2[ nrow(First_Round_2) , "Won_A"]
      
    }
    
    First_Round_2_Winner <- summarise(First_Round_2,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_2_Winner <- select(First_Round_2,
                                   contains(Winner_Suffix))
    
    First_Round_2_Winner <- First_Round_2_Winner[nrow(First_Round_2_Winner), ]
    
    colnames(First_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 3
  First_Round_3 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Metropolitan",
                          Position_in_Div == 1)
  
  First_Round_3 <- bind_rows(First_Round_3,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Wildcard_Rank == 2))
  
  First_Round_3 <- transmute(First_Round_3,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_3 <- mutate(First_Round_3,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_3[nrow(First_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_3[nrow(First_Round_3) , "Won_A"] <- if_else(First_Round_3[nrow(First_Round_3) , "Rand"] <= 
                                                                First_Round_3[nrow(First_Round_3) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_3[nrow(First_Round_3) , "Won_B"] <- 1 - First_Round_3[ , "Won_A"]
      
    }
    
    if (sum(First_Round_3[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_3[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_3[nrow(First_Round_3)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_3[nrow(First_Round_3) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_3[nrow(First_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_3[nrow(First_Round_3) , "Won_A"] <- if_else(First_Round_3[nrow(First_Round_3) , "Rand"] <= 
                                                                First_Round_3[nrow(First_Round_3) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_3[nrow(First_Round_3) , "Won_B"] <- 1 - First_Round_3[ nrow(First_Round_3) , "Won_A"]
      
    }
    
    First_Round_3_Winner <- summarise(First_Round_3,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_3_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_3_Winner <- select(First_Round_3,
                                   contains(Winner_Suffix))
    
    First_Round_3_Winner <- First_Round_3_Winner[nrow(First_Round_3_Winner), ]
    
    colnames(First_Round_3_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 4
  First_Round_4 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Metropolitan",
                          Position_in_Div == 2)
  
  First_Round_4 <- bind_rows(First_Round_4,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Division == "Metropolitan",
                                    Position_in_Div == 3))
  
  First_Round_4 <- transmute(First_Round_4,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_4 <- mutate(First_Round_4,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_4[nrow(First_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_4[nrow(First_Round_4) , "Won_A"] <- if_else(First_Round_4[nrow(First_Round_4) , "Rand"] <= 
                                                                First_Round_4[nrow(First_Round_4) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_4[nrow(First_Round_4) , "Won_B"] <- 1 - First_Round_4[ , "Won_A"]
      
    }
    
    if (sum(First_Round_4[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_4[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_4[nrow(First_Round_4)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_4[nrow(First_Round_4) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_4[nrow(First_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_4[nrow(First_Round_4) , "Won_A"] <- if_else(First_Round_4[nrow(First_Round_4) , "Rand"] <= 
                                                                First_Round_4[nrow(First_Round_4) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_4[nrow(First_Round_4) , "Won_B"] <- 1 - First_Round_4[ nrow(First_Round_4) , "Won_A"]
      
    }
    
    First_Round_4_Winner <- summarise(First_Round_4,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_4_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_4_Winner <- select(First_Round_4,
                                   contains(Winner_Suffix))
    
    First_Round_4_Winner <- First_Round_4_Winner[nrow(First_Round_4_Winner), ]
    
    colnames(First_Round_4_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 5
  First_Round_5 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Central",
                          Position_in_Div == 1)
  
  First_Round_5 <- bind_rows(First_Round_5,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Wildcard_Rank == 1))
  
  First_Round_5 <- transmute(First_Round_5,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_5 <- mutate(First_Round_5,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_5[nrow(First_Round_5) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_5[nrow(First_Round_5) , "Won_A"] <- if_else(First_Round_5[nrow(First_Round_5) , "Rand"] <= 
                                                                First_Round_5[nrow(First_Round_5) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_5[nrow(First_Round_5) , "Won_B"] <- 1 - First_Round_5[ , "Won_A"]
      
    }
    
    if (sum(First_Round_5[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_5[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_5[nrow(First_Round_5)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_5[nrow(First_Round_5) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_5[nrow(First_Round_5) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_5[nrow(First_Round_5) , "Won_A"] <- if_else(First_Round_5[nrow(First_Round_5) , "Rand"] <= 
                                                                First_Round_5[nrow(First_Round_5) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_5[nrow(First_Round_5) , "Won_B"] <- 1 - First_Round_5[ nrow(First_Round_5) , "Won_A"]
      
    }
    
    First_Round_5_Winner <- summarise(First_Round_5,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_5_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_5_Winner <- select(First_Round_5,
                                   contains(Winner_Suffix))
    
    First_Round_5_Winner <- First_Round_5_Winner[nrow(First_Round_5_Winner), ]
    
    colnames(First_Round_5_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 6
  First_Round_6 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Central",
                          Position_in_Div == 2)
  
  First_Round_6 <- bind_rows(First_Round_6,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Division == "Central",
                                    Position_in_Div == 3))
  
  First_Round_6 <- transmute(First_Round_6,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_6 <- mutate(First_Round_6,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_6[nrow(First_Round_6) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_6[nrow(First_Round_6) , "Won_A"] <- if_else(First_Round_6[nrow(First_Round_6) , "Rand"] <= 
                                                                First_Round_6[nrow(First_Round_6) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_6[nrow(First_Round_6) , "Won_B"] <- 1 - First_Round_6[ , "Won_A"]
      
    }
    
    if (sum(First_Round_6[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_6[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_6[nrow(First_Round_6)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_6[nrow(First_Round_6) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_6[nrow(First_Round_6) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_6[nrow(First_Round_6) , "Won_A"] <- if_else(First_Round_6[nrow(First_Round_6) , "Rand"] <= 
                                                                First_Round_6[nrow(First_Round_6) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_6[nrow(First_Round_6) , "Won_B"] <- 1 - First_Round_6[ nrow(First_Round_6) , "Won_A"]
      
    }
    
    First_Round_6_Winner <- summarise(First_Round_6,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_6_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_6_Winner <- select(First_Round_6,
                                   contains(Winner_Suffix))
    
    First_Round_6_Winner <- First_Round_6_Winner[nrow(First_Round_6_Winner), ]
    
    colnames(First_Round_6_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 7
  First_Round_7 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Pacific",
                          Position_in_Div == 1)
  
  First_Round_7 <- bind_rows(First_Round_7,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Wildcard_Rank == 2))
  
  First_Round_7 <- transmute(First_Round_7,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_7 <- mutate(First_Round_7,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_7[nrow(First_Round_7) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_7[nrow(First_Round_7) , "Won_A"] <- if_else(First_Round_7[nrow(First_Round_7) , "Rand"] <= 
                                                                First_Round_7[nrow(First_Round_7) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_7[nrow(First_Round_7) , "Won_B"] <- 1 - First_Round_7[ , "Won_A"]
      
    }
    
    if (sum(First_Round_7[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_7[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_7[nrow(First_Round_7)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_7[nrow(First_Round_7) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_7[nrow(First_Round_7) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_7[nrow(First_Round_7) , "Won_A"] <- if_else(First_Round_7[nrow(First_Round_7) , "Rand"] <= 
                                                                First_Round_7[nrow(First_Round_7) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_7[nrow(First_Round_7) , "Won_B"] <- 1 - First_Round_7[ nrow(First_Round_7) , "Won_A"]
      
    }
    
    First_Round_7_Winner <- summarise(First_Round_7,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_7_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_7_Winner <- select(First_Round_7,
                                   contains(Winner_Suffix))
    
    First_Round_7_Winner <- First_Round_7_Winner[nrow(First_Round_7_Winner), ]
    
    colnames(First_Round_7_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 8
  First_Round_8 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Pacific",
                          Position_in_Div == 2)
  
  First_Round_8 <- bind_rows(First_Round_8,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Division == "Pacific",
                                    Position_in_Div == 3))
  
  First_Round_8 <- transmute(First_Round_8,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_8 <- mutate(First_Round_8,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_8[nrow(First_Round_8) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_8[nrow(First_Round_8) , "Won_A"] <- if_else(First_Round_8[nrow(First_Round_8) , "Rand"] <= 
                                                                First_Round_8[nrow(First_Round_8) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_8[nrow(First_Round_8) , "Won_B"] <- 1 - First_Round_8[ , "Won_A"]
      
    }
    
    if (sum(First_Round_8[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_8[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_8[nrow(First_Round_8)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_8[nrow(First_Round_8) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_8[nrow(First_Round_8) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_8[nrow(First_Round_8) , "Won_A"] <- if_else(First_Round_8[nrow(First_Round_8) , "Rand"] <= 
                                                                First_Round_8[nrow(First_Round_8) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_8[nrow(First_Round_8) , "Won_B"] <- 1 - First_Round_8[ nrow(First_Round_8) , "Won_A"]
      
    }
    
    First_Round_8_Winner <- summarise(First_Round_8,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_8_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_8_Winner <- select(First_Round_8,
                                   contains(Winner_Suffix))
    
    First_Round_8_Winner <- First_Round_8_Winner[nrow(First_Round_8_Winner), ]
    
    colnames(First_Round_8_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ### Second Round
  
  ## Second_Round_1
  
  Second_Round_1 <- rbind(First_Round_1_Winner,
                          First_Round_2_Winner)
  
  Second_Round_1[ , "Won"] <- NA
  
  Second_Round_1 <- transmute(Second_Round_1,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_1 <- mutate(Second_Round_1,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_1[nrow(Second_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_A"] <- if_else(Second_Round_1[nrow(Second_Round_1) , "Rand"] <= 
                                                                  Second_Round_1[nrow(Second_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_B"] <- 1 - Second_Round_1[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_1[nrow(Second_Round_1)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_1[nrow(Second_Round_1) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_1[nrow(Second_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_A"] <- if_else(Second_Round_1[nrow(Second_Round_1) , "Rand"] <= 
                                                                  Second_Round_1[nrow(Second_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_B"] <- 1 - Second_Round_1[ nrow(Second_Round_1) , "Won_A"]
      
    }
    
    Second_Round_1_Winner <- summarise(Second_Round_1,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_1_Winner <- select(Second_Round_1,
                                    contains(Winner_Suffix))
    
    Second_Round_1_Winner <- Second_Round_1_Winner[nrow(Second_Round_1_Winner), ]
    
    colnames(Second_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  
  ## Second_Round_2
  
  Second_Round_2 <- rbind(First_Round_3_Winner,
                          First_Round_4_Winner)
  
  Second_Round_2[ , "Won"] <- NA
  
  Second_Round_2 <- transmute(Second_Round_2,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_2 <- mutate(Second_Round_2,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_2[nrow(Second_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_A"] <- if_else(Second_Round_2[nrow(Second_Round_2) , "Rand"] <= 
                                                                  Second_Round_2[nrow(Second_Round_2) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_B"] <- 1 - Second_Round_2[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_2[nrow(Second_Round_2)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_2[nrow(Second_Round_2) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_2[nrow(Second_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_A"] <- if_else(Second_Round_2[nrow(Second_Round_2) , "Rand"] <= 
                                                                  Second_Round_2[nrow(Second_Round_2) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_B"] <- 1 - Second_Round_2[ nrow(Second_Round_2) , "Won_A"]
      
    }
    
    Second_Round_2_Winner <- summarise(Second_Round_2,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_2_Winner <- select(Second_Round_2,
                                    contains(Winner_Suffix))
    
    Second_Round_2_Winner <- Second_Round_2_Winner[nrow(Second_Round_2_Winner), ]
    
    colnames(Second_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Second_Round_3
  
  Second_Round_3 <- rbind(First_Round_5_Winner,
                          First_Round_6_Winner)
  
  Second_Round_3[ , "Won"] <- NA
  
  Second_Round_3 <- transmute(Second_Round_3,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_3 <- mutate(Second_Round_3,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_3[nrow(Second_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_A"] <- if_else(Second_Round_3[nrow(Second_Round_3) , "Rand"] <= 
                                                                  Second_Round_3[nrow(Second_Round_3) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_B"] <- 1 - Second_Round_3[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_3[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_3[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_3[nrow(Second_Round_3)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_3[nrow(Second_Round_3) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_3[nrow(Second_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_A"] <- if_else(Second_Round_3[nrow(Second_Round_3) , "Rand"] <= 
                                                                  Second_Round_3[nrow(Second_Round_3) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_B"] <- 1 - Second_Round_3[ nrow(Second_Round_3) , "Won_A"]
      
    }
    
    Second_Round_3_Winner <- summarise(Second_Round_3,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_3_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_3_Winner <- select(Second_Round_3,
                                    contains(Winner_Suffix))
    
    Second_Round_3_Winner <- Second_Round_3_Winner[nrow(Second_Round_3_Winner), ]
    
    colnames(Second_Round_3_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Second_Round_4
  
  Second_Round_4 <- rbind(First_Round_7_Winner,
                          First_Round_8_Winner)
  
  Second_Round_4[ , "Won"] <- NA
  
  Second_Round_4 <- transmute(Second_Round_4,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_4 <- mutate(Second_Round_4,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_4[nrow(Second_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_A"] <- if_else(Second_Round_4[nrow(Second_Round_4) , "Rand"] <= 
                                                                  Second_Round_4[nrow(Second_Round_4) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_B"] <- 1 - Second_Round_4[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_4[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_4[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_4[nrow(Second_Round_4)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_4[nrow(Second_Round_4) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_4[nrow(Second_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_A"] <- if_else(Second_Round_4[nrow(Second_Round_4) , "Rand"] <= 
                                                                  Second_Round_4[nrow(Second_Round_4) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_B"] <- 1 - Second_Round_4[ nrow(Second_Round_4) , "Won_A"]
      
    }
    
    Second_Round_4_Winner <- summarise(Second_Round_4,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_4_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_4_Winner <- select(Second_Round_4,
                                    contains(Winner_Suffix))
    
    Second_Round_4_Winner <- Second_Round_4_Winner[nrow(Second_Round_4_Winner), ]
    
    colnames(Second_Round_4_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ### Conference Round
  
  ## Conference_Round_1
  
  Conf_Round_1 <- rbind(Second_Round_1_Winner,
                        Second_Round_2_Winner)
  
  Conf_Round_1[ , "Won"] <- NA
  
  Conf_Round_1 <- transmute(Conf_Round_1,
                            Team_A = Team[1],
                            Team_B = Team[2],
                            Rating_A = Rating[1],
                            Rating_B = Rating[2],
                            Conference_A = Conference[1],
                            Conference_B = Conference[2])[1 , ]
  
  Conf_Round_1 <- mutate(Conf_Round_1,
                         Expected = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))),
                         "Rand" = NA,
                         "Won_A" = NA,
                         "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_A"] <- if_else(Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <= 
                                                              Conf_Round_1[nrow(Conf_Round_1) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_B"] <- 1 - Conf_Round_1[ , "Won_A"]
      
    }
    
    if (sum(Conf_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(Conf_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Conf_Round_1[nrow(Conf_Round_1)+1 , c("Team_A",
                                            "Team_B",
                                            "Rating_A",
                                            "Rating_B",
                                            "Conference_A",
                                            "Conference_B",
                                            "Expected")] <- Conf_Round_1[nrow(Conf_Round_1) , c("Team_A",
                                                                                                "Team_B",
                                                                                                "Rating_A",
                                                                                                "Rating_B",
                                                                                                "Conference_A",
                                                                                                "Conference_B",
                                                                                                "Expected")]
      
      Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_A"] <- if_else(Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <= 
                                                              Conf_Round_1[nrow(Conf_Round_1) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_B"] <- 1 - Conf_Round_1[ nrow(Conf_Round_1) , "Won_A"]
      
    }
    
    Conf_Round_1_Winner <- summarise(Conf_Round_1,
                                     "Wins_A" = sum(Won_A),
                                     "Wins_B" = sum(Won_B),
                                     "Winner" = if_else(Wins_A == 4,
                                                        "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Conf_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Conf_Round_1_Winner <- select(Conf_Round_1,
                                  contains(Winner_Suffix))
    
    Conf_Round_1_Winner <- Conf_Round_1_Winner[nrow(Conf_Round_1_Winner), ]
    
    colnames(Conf_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Conference_Round_2
  
  Conf_Round_2 <- rbind(Second_Round_3_Winner,
                        Second_Round_4_Winner)
  
  Conf_Round_2[ , "Won"] <- NA
  
  Conf_Round_2 <- transmute(Conf_Round_2,
                            Team_A = Team[1],
                            Team_B = Team[2],
                            Rating_A = Rating[1],
                            Rating_B = Rating[2],
                            Conference_A = Conference[1],
                            Conference_B = Conference[2])[1 , ]
  
  Conf_Round_2 <- mutate(Conf_Round_2,
                         Expected = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))),
                         "Rand" = NA,
                         "Won_A" = NA,
                         "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_A"] <- if_else(Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <= 
                                                              Conf_Round_2[nrow(Conf_Round_2) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_B"] <- 1 - Conf_Round_2[ , "Won_A"]
      
    }
    
    if (sum(Conf_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(Conf_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Conf_Round_2[nrow(Conf_Round_2)+1 , c("Team_A",
                                            "Team_B",
                                            "Rating_A",
                                            "Rating_B",
                                            "Conference_A",
                                            "Conference_B",
                                            "Expected")] <- Conf_Round_2[nrow(Conf_Round_2) , c("Team_A",
                                                                                                "Team_B",
                                                                                                "Rating_A",
                                                                                                "Rating_B",
                                                                                                "Conference_A",
                                                                                                "Conference_B",
                                                                                                "Expected")]
      
      Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_A"] <- if_else(Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <= 
                                                              Conf_Round_2[nrow(Conf_Round_2) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_B"] <- 1 - Conf_Round_2[ nrow(Conf_Round_2) , "Won_A"]
      
    }
    
    Conf_Round_2_Winner <- summarise(Conf_Round_2,
                                     "Wins_A" = sum(Won_A),
                                     "Wins_B" = sum(Won_B),
                                     "Winner" = if_else(Wins_A == 4,
                                                        "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Conf_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Conf_Round_2_Winner <- select(Conf_Round_2,
                                  contains(Winner_Suffix))
    
    Conf_Round_2_Winner <- Conf_Round_2_Winner[nrow(Conf_Round_2_Winner), ]
    
    colnames(Conf_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Conference_Round_1
  
  Stanley_Cup_Round <- rbind(Conf_Round_1_Winner,
                             Conf_Round_2_Winner)
  
  Stanley_Cup_Round[ , "Won"] <- NA
  
  Stanley_Cup_Round <- transmute(Stanley_Cup_Round,
                                 Team_A = Team[1],
                                 Team_B = Team[2],
                                 Rating_A = Rating[1],
                                 Rating_B = Rating[2],
                                 Conference_A = Conference[1],
                                 Conference_B = Conference[2])[1 , ]
  
  Stanley_Cup_Round <- mutate(Stanley_Cup_Round,
                              Expected = (1 / 
                                            (1 + 10^(-(Rating_A - Rating_B) / 400))),
                              "Rand" = NA,
                              "Won_A" = NA,
                              "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <- runif(1, 0, 1)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_A"] <- if_else(Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <= 
                                                                        Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Expected"],
                                                                      true = 1,
                                                                      false = 0)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_B"] <- 1 - Stanley_Cup_Round[ , "Won_A"]
      
    }
    
    if (sum(Stanley_Cup_Round[ , "Won_A"], na.rm = T) == 4 || sum(Stanley_Cup_Round[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round)+1 , c("Team_A",
                                                      "Team_B",
                                                      "Rating_A",
                                                      "Rating_B",
                                                      "Conference_A",
                                                      "Conference_B",
                                                      "Expected")] <- Stanley_Cup_Round[nrow(Stanley_Cup_Round) , c("Team_A",
                                                                                                                    "Team_B",
                                                                                                                    "Rating_A",
                                                                                                                    "Rating_B",
                                                                                                                    "Conference_A",
                                                                                                                    "Conference_B",
                                                                                                                    "Expected")]
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <- runif(1, 0, 1)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_A"] <- if_else(Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <= 
                                                                        Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Expected"],
                                                                      true = 1,
                                                                      false = 0)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_B"] <- 1 - Stanley_Cup_Round[ nrow(Stanley_Cup_Round) , "Won_A"]
      
    }
    
    Stanley_Cup_Round <- mutate(Stanley_Cup_Round,
                                Sim_No = sim_no)
    
    Stanley_Cup_Round_Winner <- summarise(Stanley_Cup_Round,
                                          "Wins_A" = sum(Won_A),
                                          "Wins_B" = sum(Won_B),
                                          "Winner" = if_else(Wins_A == 4,
                                                             "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Stanley_Cup_Round_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Stanley_Cup_Round_Winner <- select(Stanley_Cup_Round,
                                       contains(Winner_Suffix))
    
    Stanley_Cup_Round_Winner <- Stanley_Cup_Round_Winner[nrow(Stanley_Cup_Round_Winner), ]
    
    Stanley_Cup_Round_Winner <- mutate(Stanley_Cup_Round_Winner,
                                       Sim_No = sim_no)
    
    colnames(Stanley_Cup_Round_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  Monte_Results_Season_51 <- rbind(Monte_Results_Season_51,
                                ungroup(Game_Monte_Sum))
  
  for (round_ind in ls()[which(str_detect(ls(), "First_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_First_Round_51 <- rbind(Monte_Results_First_Round_51,
                                     First_Round_1,
                                     First_Round_2,
                                     First_Round_3,
                                     First_Round_4,
                                     First_Round_5,
                                     First_Round_6,
                                     First_Round_7,
                                     First_Round_8)
  
  for (round_ind in ls()[which(str_detect(ls(), "Second_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_Second_Round_51 <- rbind(Monte_Results_Second_Round_51,
                                      Second_Round_1,
                                      Second_Round_2,
                                      Second_Round_3,
                                      Second_Round_4)
  
  for (round_ind in ls()[which(str_detect(ls(), "Conf_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_Conf_Round_51 <- rbind(Monte_Results_Conf_Round_51,
                                    Conf_Round_1,
                                    Conf_Round_2)
  
  Monte_Results_Stanley_Round_51 <- rbind(Monte_Results_Stanley_Round_51,
                                       Stanley_Cup_Round)
  
  Monte_Results_Stanley_Round_Winner_51 <- rbind(Monte_Results_Stanley_Round_Winner_51,
                                                 Stanley_Cup_Round_Winner)
  

}

```

```{r, fig.height=9}

ggplot(Monte_Results_Season,
       aes(x = Position)) +
  geom_density(fill = "cyan2",
                alpha = 0.25) +
  facet_rep_wrap( ~ Team_Name,
                  repeat.tick.labels = T,
                  nrow = 4) +
  ggtitle(label = paste("Probability Density of Each Team's Finishing Standing in the NHL",
                        "Across", comma(sim_no), "Trials"),
          subtitle = "Using the Elo 25 Partition") +
  theme_minimal()

```

```{r}

St_Louis_Results_51 <- filter(summarise(group_by(Monte_Results_Season_51,
                                                 Team_Name, Position),
                                        "Count" = n()),
                              Team_Name == "St. Louis Blues")

ggplot(St_Louis_Results_51,
       aes(x = Position, y = Count)) +
  geom_bar(stat = "identity",
           col = "yellow",
           fill = "blue3") +
  ggtitle(label = paste("Frequencies of Finishing Position for St. Louis Blues Across",
                        comma(sim_no), "Trials"),
          subtitle = "Using the Elo 50 Partition") +
  scale_x_continuous(breaks = seq(1,31,2))+
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank())

ggplot(Monte_Results_Stanley_Round_Winner_51) +
  geom_bar(aes(x = Team),
           fill = "cyan",
           alpha = 0.5) +
  geom_text(aes(x = Team,
                y = ..count..,
                label = ..count..,
                hjust = -0.25),
            stat = "count") +
  scale_x_discrete("Team",
                   limits = rev(levels(as.factor(Monte_Results_Stanley_Round_Winner$Team)))) +
  scale_y_continuous("Number of Stanley Cup Wins",
                     labels = comma) +
  theme_minimal() +
  ggtitle(label = paste("Stanley Cup Winning Teams in",
                        comma(sim_no),
                        "Trials"),
          subtitle = "Using Elo 50 Partition") +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip()

```

```{r, message=FALSE, warning=FALSE}

## Finals Series simulator for Partition 82

Conferences_Divisions_82 <- select(Game_Data_Finals,
                                   Team = Team_A,
                                   Division,
                                   Conference)

Game_Data_82 <- left_join(Game_Data_82,
                          Conferences_Divisions_82,
                          by = c("Team_A" = "Team"))

Game_Data_82 <- rename(Game_Data_82,
                       Division_A = Division,
                       Conference_A = Conference)

Game_Data_82 <- left_join(Game_Data_82,
                          Conferences_Divisions_82,
                          by = c("Team_B" = "Team"))

Game_Data_82 <- rename(Game_Data_82,
                       Division_B = Division,
                       Conference_B = Conference)

Game_Monte_82 <- Game_Data_82

Monte_Results_Season_82 <- data.frame()
Monte_Results_First_Round_82 <- data.frame()
Monte_Results_Second_Round_82 <- data.frame()
Monte_Results_Conf_Round_82 <- data.frame()
Monte_Results_Stanley_Round_82 <- data.frame()
Monte_Results_Stanley_Round_Winner_82 <- data.frame()

Start_Time <- Sys.time()

Game_Monte_82 <- rename(Game_Monte_82,
                        Points_A = Pts_A,
                        Points_B = Pts_B)

for (sim_no in 1:2500) {
  
  Game_Monte_Long <- gather(Game_Monte_82,
                            Team_A, Team_B,
                            key = "Team_Order",
                            value = "Team_Name")
  
  Game_Monte_Sum <- summarise(group_by(Game_Monte_Long,
                                       Team_Name),
                              Points = sum(Points_A[Team_Order == "Team_A"] +
                                             Points_B[Team_Order == "Team_B"]))
  
  Game_Monte_Sum <- left_join(x = Game_Monte_Sum,
                              y = Elo_82,
                              by = c("Team_Name" = "Team"))
  
  Game_Monte_Sum <- mutate(Game_Monte_Sum,
                           Adjusted_Points = Points + Rating/10000)
  
  Game_Monte_Sum <- mutate(ungroup(Game_Monte_Sum),
                           Position = rank(-Adjusted_Points, "min"),
                           Sim_No = sim_no)
  
  Game_Monte_Sum <- left_join(Game_Monte_Sum,
                              Conferences_Divisions_82,
                              by = c("Team_Name" = "Team"))
  
  Game_Monte_Sum <- mutate(group_by(Game_Monte_Sum,
                                    Division),
                           Position_in_Div = rank(-Adjusted_Points))
  
  Game_Monte_Sum <- mutate(group_by(Game_Monte_Sum,
                                    Conference),
                           Position_in_Conf = rank(-Adjusted_Points))
  
  Finals <- filter(Game_Monte_Sum,
                   Position_in_Div <= 3)
  
  Wildcards <- filter(Game_Monte_Sum,
                      !(Team_Name %in% Finals$Team_Name))
  
  Wildcards <- mutate(Wildcards,
                      "Wildcard_Rank" = rank(-Position_in_Conf))
  
  Finals <- rbind(Finals,
                  filter(Wildcards,
                         Wildcard_Rank <= 2))
  
  ## First Round 1
  First_Round_1 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Atlantic",
                          Position_in_Div == 1)
  
  First_Round_1 <- bind_rows(First_Round_1,
                             filter(Finals,
                                    Conference == "Eastern",
                                    Wildcard_Rank == 1))
  
  First_Round_1 <- transmute(First_Round_1,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_1 <- mutate(First_Round_1,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_1[nrow(First_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_1[nrow(First_Round_1) , "Won_A"] <- if_else(First_Round_1[nrow(First_Round_1) , "Rand"] <= 
                                                                First_Round_1[nrow(First_Round_1) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_1[nrow(First_Round_1) , "Won_B"] <- 1 - First_Round_1[ , "Won_A"]
      
    }
    
    if (sum(First_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_1[nrow(First_Round_1)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_1[nrow(First_Round_1) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_1[nrow(First_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_1[nrow(First_Round_1) , "Won_A"] <- if_else(First_Round_1[nrow(First_Round_1) , "Rand"] <= 
                                                                First_Round_1[nrow(First_Round_1) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_1[nrow(First_Round_1) , "Won_B"] <- 1 - First_Round_1[ nrow(First_Round_1) , "Won_A"]
      
    }
    
    First_Round_1_Winner <- summarise(First_Round_1,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_1_Winner <- select(First_Round_1,
                                   contains(Winner_Suffix))
    
    First_Round_1_Winner <- First_Round_1_Winner[nrow(First_Round_1_Winner), ]
    
    colnames(First_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 2
  First_Round_2 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Atlantic",
                          Position_in_Div == 2)
  
  First_Round_2 <- bind_rows(First_Round_2,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Division == "Atlantic",
                                    Position_in_Div == 3))
  
  First_Round_2 <- transmute(First_Round_2,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_2 <- mutate(First_Round_2,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_2[nrow(First_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_2[nrow(First_Round_2) , "Won_A"] <- if_else(First_Round_2[nrow(First_Round_2) , "Rand"] <= 
                                                                First_Round_2[nrow(First_Round_2) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_2[nrow(First_Round_2) , "Won_B"] <- 1 - First_Round_2[ , "Won_A"]
      
    }
    
    if (sum(First_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_2[nrow(First_Round_2)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_2[nrow(First_Round_2) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_2[nrow(First_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_2[nrow(First_Round_2) , "Won_A"] <- if_else(First_Round_2[nrow(First_Round_2) , "Rand"] <= 
                                                                First_Round_2[nrow(First_Round_2) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_2[nrow(First_Round_2) , "Won_B"] <- 1 - First_Round_2[ nrow(First_Round_2) , "Won_A"]
      
    }
    
    First_Round_2_Winner <- summarise(First_Round_2,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_2_Winner <- select(First_Round_2,
                                   contains(Winner_Suffix))
    
    First_Round_2_Winner <- First_Round_2_Winner[nrow(First_Round_2_Winner), ]
    
    colnames(First_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 3
  First_Round_3 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Metropolitan",
                          Position_in_Div == 1)
  
  First_Round_3 <- bind_rows(First_Round_3,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Wildcard_Rank == 2))
  
  First_Round_3 <- transmute(First_Round_3,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_3 <- mutate(First_Round_3,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_3[nrow(First_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_3[nrow(First_Round_3) , "Won_A"] <- if_else(First_Round_3[nrow(First_Round_3) , "Rand"] <= 
                                                                First_Round_3[nrow(First_Round_3) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_3[nrow(First_Round_3) , "Won_B"] <- 1 - First_Round_3[ , "Won_A"]
      
    }
    
    if (sum(First_Round_3[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_3[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_3[nrow(First_Round_3)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_3[nrow(First_Round_3) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_3[nrow(First_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_3[nrow(First_Round_3) , "Won_A"] <- if_else(First_Round_3[nrow(First_Round_3) , "Rand"] <= 
                                                                First_Round_3[nrow(First_Round_3) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_3[nrow(First_Round_3) , "Won_B"] <- 1 - First_Round_3[ nrow(First_Round_3) , "Won_A"]
      
    }
    
    First_Round_3_Winner <- summarise(First_Round_3,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_3_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_3_Winner <- select(First_Round_3,
                                   contains(Winner_Suffix))
    
    First_Round_3_Winner <- First_Round_3_Winner[nrow(First_Round_3_Winner), ]
    
    colnames(First_Round_3_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 4
  First_Round_4 <- filter(ungroup(Finals),
                          Conference == "Eastern",
                          Division == "Metropolitan",
                          Position_in_Div == 2)
  
  First_Round_4 <- bind_rows(First_Round_4,
                             filter(ungroup(Finals),
                                    Conference == "Eastern",
                                    Division == "Metropolitan",
                                    Position_in_Div == 3))
  
  First_Round_4 <- transmute(First_Round_4,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_4 <- mutate(First_Round_4,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_4[nrow(First_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_4[nrow(First_Round_4) , "Won_A"] <- if_else(First_Round_4[nrow(First_Round_4) , "Rand"] <= 
                                                                First_Round_4[nrow(First_Round_4) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_4[nrow(First_Round_4) , "Won_B"] <- 1 - First_Round_4[ , "Won_A"]
      
    }
    
    if (sum(First_Round_4[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_4[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_4[nrow(First_Round_4)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_4[nrow(First_Round_4) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_4[nrow(First_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_4[nrow(First_Round_4) , "Won_A"] <- if_else(First_Round_4[nrow(First_Round_4) , "Rand"] <= 
                                                                First_Round_4[nrow(First_Round_4) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_4[nrow(First_Round_4) , "Won_B"] <- 1 - First_Round_4[ nrow(First_Round_4) , "Won_A"]
      
    }
    
    First_Round_4_Winner <- summarise(First_Round_4,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_4_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_4_Winner <- select(First_Round_4,
                                   contains(Winner_Suffix))
    
    First_Round_4_Winner <- First_Round_4_Winner[nrow(First_Round_4_Winner), ]
    
    colnames(First_Round_4_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 5
  First_Round_5 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Central",
                          Position_in_Div == 1)
  
  First_Round_5 <- bind_rows(First_Round_5,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Wildcard_Rank == 1))
  
  First_Round_5 <- transmute(First_Round_5,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_5 <- mutate(First_Round_5,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_5[nrow(First_Round_5) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_5[nrow(First_Round_5) , "Won_A"] <- if_else(First_Round_5[nrow(First_Round_5) , "Rand"] <= 
                                                                First_Round_5[nrow(First_Round_5) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_5[nrow(First_Round_5) , "Won_B"] <- 1 - First_Round_5[ , "Won_A"]
      
    }
    
    if (sum(First_Round_5[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_5[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_5[nrow(First_Round_5)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_5[nrow(First_Round_5) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_5[nrow(First_Round_5) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_5[nrow(First_Round_5) , "Won_A"] <- if_else(First_Round_5[nrow(First_Round_5) , "Rand"] <= 
                                                                First_Round_5[nrow(First_Round_5) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_5[nrow(First_Round_5) , "Won_B"] <- 1 - First_Round_5[ nrow(First_Round_5) , "Won_A"]
      
    }
    
    First_Round_5_Winner <- summarise(First_Round_5,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_5_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_5_Winner <- select(First_Round_5,
                                   contains(Winner_Suffix))
    
    First_Round_5_Winner <- First_Round_5_Winner[nrow(First_Round_5_Winner), ]
    
    colnames(First_Round_5_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 6
  First_Round_6 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Central",
                          Position_in_Div == 2)
  
  First_Round_6 <- bind_rows(First_Round_6,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Division == "Central",
                                    Position_in_Div == 3))
  
  First_Round_6 <- transmute(First_Round_6,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_6 <- mutate(First_Round_6,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_6[nrow(First_Round_6) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_6[nrow(First_Round_6) , "Won_A"] <- if_else(First_Round_6[nrow(First_Round_6) , "Rand"] <= 
                                                                First_Round_6[nrow(First_Round_6) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_6[nrow(First_Round_6) , "Won_B"] <- 1 - First_Round_6[ , "Won_A"]
      
    }
    
    if (sum(First_Round_6[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_6[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_6[nrow(First_Round_6)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_6[nrow(First_Round_6) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_6[nrow(First_Round_6) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_6[nrow(First_Round_6) , "Won_A"] <- if_else(First_Round_6[nrow(First_Round_6) , "Rand"] <= 
                                                                First_Round_6[nrow(First_Round_6) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_6[nrow(First_Round_6) , "Won_B"] <- 1 - First_Round_6[ nrow(First_Round_6) , "Won_A"]
      
    }
    
    First_Round_6_Winner <- summarise(First_Round_6,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_6_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_6_Winner <- select(First_Round_6,
                                   contains(Winner_Suffix))
    
    First_Round_6_Winner <- First_Round_6_Winner[nrow(First_Round_6_Winner), ]
    
    colnames(First_Round_6_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 7
  First_Round_7 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Pacific",
                          Position_in_Div == 1)
  
  First_Round_7 <- bind_rows(First_Round_7,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Wildcard_Rank == 2))
  
  First_Round_7 <- transmute(First_Round_7,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_7 <- mutate(First_Round_7,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_7[nrow(First_Round_7) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_7[nrow(First_Round_7) , "Won_A"] <- if_else(First_Round_7[nrow(First_Round_7) , "Rand"] <= 
                                                                First_Round_7[nrow(First_Round_7) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_7[nrow(First_Round_7) , "Won_B"] <- 1 - First_Round_7[ , "Won_A"]
      
    }
    
    if (sum(First_Round_7[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_7[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_7[nrow(First_Round_7)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_7[nrow(First_Round_7) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_7[nrow(First_Round_7) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_7[nrow(First_Round_7) , "Won_A"] <- if_else(First_Round_7[nrow(First_Round_7) , "Rand"] <= 
                                                                First_Round_7[nrow(First_Round_7) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_7[nrow(First_Round_7) , "Won_B"] <- 1 - First_Round_7[ nrow(First_Round_7) , "Won_A"]
      
    }
    
    First_Round_7_Winner <- summarise(First_Round_7,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_7_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_7_Winner <- select(First_Round_7,
                                   contains(Winner_Suffix))
    
    First_Round_7_Winner <- First_Round_7_Winner[nrow(First_Round_7_Winner), ]
    
    colnames(First_Round_7_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ## First Round 8
  First_Round_8 <- filter(ungroup(Finals),
                          Conference == "Western",
                          Division == "Pacific",
                          Position_in_Div == 2)
  
  First_Round_8 <- bind_rows(First_Round_8,
                             filter(ungroup(Finals),
                                    Conference == "Western",
                                    Division == "Pacific",
                                    Position_in_Div == 3))
  
  First_Round_8 <- transmute(First_Round_8,
                             Team_A = Team_Name[1],
                             Team_B = Team_Name[2],
                             Rating_A = Rating[1],
                             Rating_B = Rating[2],
                             Conference_A = Conference[1],
                             Conference_B = Conference[2])[1 , ]
  
  First_Round_8 <- mutate(First_Round_8,
                          Expected = (1 / 
                                        (1 + 10^(-(Rating_A - Rating_B) / 400))),
                          "Rand" = NA,
                          "Won_A" = NA,
                          "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      First_Round_8[nrow(First_Round_8) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_8[nrow(First_Round_8) , "Won_A"] <- if_else(First_Round_8[nrow(First_Round_8) , "Rand"] <= 
                                                                First_Round_8[nrow(First_Round_8) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_8[nrow(First_Round_8) , "Won_B"] <- 1 - First_Round_8[ , "Won_A"]
      
    }
    
    if (sum(First_Round_8[ , "Won_A"], na.rm = T) == 4 || sum(First_Round_8[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      First_Round_8[nrow(First_Round_8)+1 , c("Team_A",
                                              "Team_B",
                                              "Rating_A",
                                              "Rating_B",
                                              "Conference_A",
                                              "Conference_B",
                                              "Expected")] <- First_Round_8[nrow(First_Round_8) , c("Team_A",
                                                                                                    "Team_B",
                                                                                                    "Rating_A",
                                                                                                    "Rating_B",
                                                                                                    "Conference_A",
                                                                                                    "Conference_B",
                                                                                                    "Expected")]
      
      First_Round_8[nrow(First_Round_8) , "Rand"] <- runif(1, 0, 1)
      
      First_Round_8[nrow(First_Round_8) , "Won_A"] <- if_else(First_Round_8[nrow(First_Round_8) , "Rand"] <= 
                                                                First_Round_8[nrow(First_Round_8) , "Expected"],
                                                              true = 1,
                                                              false = 0)
      
      First_Round_8[nrow(First_Round_8) , "Won_B"] <- 1 - First_Round_8[ nrow(First_Round_8) , "Won_A"]
      
    }
    
    First_Round_8_Winner <- summarise(First_Round_8,
                                      "Wins_A" = sum(Won_A),
                                      "Wins_B" = sum(Won_B),
                                      "Winner" = if_else(Wins_A == 4,
                                                         "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(First_Round_8_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    First_Round_8_Winner <- select(First_Round_8,
                                   contains(Winner_Suffix))
    
    First_Round_8_Winner <- First_Round_8_Winner[nrow(First_Round_8_Winner), ]
    
    colnames(First_Round_8_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  ### Second Round
  
  ## Second_Round_1
  
  Second_Round_1 <- rbind(First_Round_1_Winner,
                          First_Round_2_Winner)
  
  Second_Round_1[ , "Won"] <- NA
  
  Second_Round_1 <- transmute(Second_Round_1,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_1 <- mutate(Second_Round_1,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_1[nrow(Second_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_A"] <- if_else(Second_Round_1[nrow(Second_Round_1) , "Rand"] <= 
                                                                  Second_Round_1[nrow(Second_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_B"] <- 1 - Second_Round_1[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_1[nrow(Second_Round_1)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_1[nrow(Second_Round_1) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_1[nrow(Second_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_A"] <- if_else(Second_Round_1[nrow(Second_Round_1) , "Rand"] <= 
                                                                  Second_Round_1[nrow(Second_Round_1) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_1[nrow(Second_Round_1) , "Won_B"] <- 1 - Second_Round_1[ nrow(Second_Round_1) , "Won_A"]
      
    }
    
    Second_Round_1_Winner <- summarise(Second_Round_1,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_1_Winner <- select(Second_Round_1,
                                    contains(Winner_Suffix))
    
    Second_Round_1_Winner <- Second_Round_1_Winner[nrow(Second_Round_1_Winner), ]
    
    colnames(Second_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
    
  }
  
  
  ## Second_Round_2
  
  Second_Round_2 <- rbind(First_Round_3_Winner,
                          First_Round_4_Winner)
  
  Second_Round_2[ , "Won"] <- NA
  
  Second_Round_2 <- transmute(Second_Round_2,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_2 <- mutate(Second_Round_2,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_2[nrow(Second_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_A"] <- if_else(Second_Round_2[nrow(Second_Round_2) , "Rand"] <= 
                                                                  Second_Round_2[nrow(Second_Round_2) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_B"] <- 1 - Second_Round_2[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_2[nrow(Second_Round_2)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_2[nrow(Second_Round_2) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_2[nrow(Second_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_A"] <- if_else(Second_Round_2[nrow(Second_Round_2) , "Rand"] <= 
                                                                  Second_Round_2[nrow(Second_Round_2) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_2[nrow(Second_Round_2) , "Won_B"] <- 1 - Second_Round_2[ nrow(Second_Round_2) , "Won_A"]
      
    }
    
    Second_Round_2_Winner <- summarise(Second_Round_2,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_2_Winner <- select(Second_Round_2,
                                    contains(Winner_Suffix))
    
    Second_Round_2_Winner <- Second_Round_2_Winner[nrow(Second_Round_2_Winner), ]
    
    colnames(Second_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Second_Round_3
  
  Second_Round_3 <- rbind(First_Round_5_Winner,
                          First_Round_6_Winner)
  
  Second_Round_3[ , "Won"] <- NA
  
  Second_Round_3 <- transmute(Second_Round_3,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_3 <- mutate(Second_Round_3,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_3[nrow(Second_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_A"] <- if_else(Second_Round_3[nrow(Second_Round_3) , "Rand"] <= 
                                                                  Second_Round_3[nrow(Second_Round_3) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_B"] <- 1 - Second_Round_3[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_3[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_3[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_3[nrow(Second_Round_3)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_3[nrow(Second_Round_3) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_3[nrow(Second_Round_3) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_A"] <- if_else(Second_Round_3[nrow(Second_Round_3) , "Rand"] <= 
                                                                  Second_Round_3[nrow(Second_Round_3) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_3[nrow(Second_Round_3) , "Won_B"] <- 1 - Second_Round_3[ nrow(Second_Round_3) , "Won_A"]
      
    }
    
    Second_Round_3_Winner <- summarise(Second_Round_3,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_3_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_3_Winner <- select(Second_Round_3,
                                    contains(Winner_Suffix))
    
    Second_Round_3_Winner <- Second_Round_3_Winner[nrow(Second_Round_3_Winner), ]
    
    colnames(Second_Round_3_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Second_Round_4
  
  Second_Round_4 <- rbind(First_Round_7_Winner,
                          First_Round_8_Winner)
  
  Second_Round_4[ , "Won"] <- NA
  
  Second_Round_4 <- transmute(Second_Round_4,
                              Team_A = Team[1],
                              Team_B = Team[2],
                              Rating_A = Rating[1],
                              Rating_B = Rating[2],
                              Conference_A = Conference[1],
                              Conference_B = Conference[2])[1 , ]
  
  Second_Round_4 <- mutate(Second_Round_4,
                           Expected = (1 / 
                                         (1 + 10^(-(Rating_A - Rating_B) / 400))),
                           "Rand" = NA,
                           "Won_A" = NA,
                           "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Second_Round_4[nrow(Second_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_A"] <- if_else(Second_Round_4[nrow(Second_Round_4) , "Rand"] <= 
                                                                  Second_Round_4[nrow(Second_Round_4) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_B"] <- 1 - Second_Round_4[ , "Won_A"]
      
    }
    
    if (sum(Second_Round_4[ , "Won_A"], na.rm = T) == 4 || sum(Second_Round_4[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Second_Round_4[nrow(Second_Round_4)+1 , c("Team_A",
                                                "Team_B",
                                                "Rating_A",
                                                "Rating_B",
                                                "Conference_A",
                                                "Conference_B",
                                                "Expected")] <- Second_Round_4[nrow(Second_Round_4) , c("Team_A",
                                                                                                        "Team_B",
                                                                                                        "Rating_A",
                                                                                                        "Rating_B",
                                                                                                        "Conference_A",
                                                                                                        "Conference_B",
                                                                                                        "Expected")]
      
      Second_Round_4[nrow(Second_Round_4) , "Rand"] <- runif(1, 0, 1)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_A"] <- if_else(Second_Round_4[nrow(Second_Round_4) , "Rand"] <= 
                                                                  Second_Round_4[nrow(Second_Round_4) , "Expected"],
                                                                true = 1,
                                                                false = 0)
      
      Second_Round_4[nrow(Second_Round_4) , "Won_B"] <- 1 - Second_Round_4[ nrow(Second_Round_4) , "Won_A"]
      
    }
    
    Second_Round_4_Winner <- summarise(Second_Round_4,
                                       "Wins_A" = sum(Won_A),
                                       "Wins_B" = sum(Won_B),
                                       "Winner" = if_else(Wins_A == 4,
                                                          "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Second_Round_4_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Second_Round_4_Winner <- select(Second_Round_4,
                                    contains(Winner_Suffix))
    
    Second_Round_4_Winner <- Second_Round_4_Winner[nrow(Second_Round_4_Winner), ]
    
    colnames(Second_Round_4_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ### Conference Round
  
  ## Conference_Round_1
  
  Conf_Round_1 <- rbind(Second_Round_1_Winner,
                        Second_Round_2_Winner)
  
  Conf_Round_1[ , "Won"] <- NA
  
  Conf_Round_1 <- transmute(Conf_Round_1,
                            Team_A = Team[1],
                            Team_B = Team[2],
                            Rating_A = Rating[1],
                            Rating_B = Rating[2],
                            Conference_A = Conference[1],
                            Conference_B = Conference[2])[1 , ]
  
  Conf_Round_1 <- mutate(Conf_Round_1,
                         Expected = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))),
                         "Rand" = NA,
                         "Won_A" = NA,
                         "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_A"] <- if_else(Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <= 
                                                              Conf_Round_1[nrow(Conf_Round_1) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_B"] <- 1 - Conf_Round_1[ , "Won_A"]
      
    }
    
    if (sum(Conf_Round_1[ , "Won_A"], na.rm = T) == 4 || sum(Conf_Round_1[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Conf_Round_1[nrow(Conf_Round_1)+1 , c("Team_A",
                                            "Team_B",
                                            "Rating_A",
                                            "Rating_B",
                                            "Conference_A",
                                            "Conference_B",
                                            "Expected")] <- Conf_Round_1[nrow(Conf_Round_1) , c("Team_A",
                                                                                                "Team_B",
                                                                                                "Rating_A",
                                                                                                "Rating_B",
                                                                                                "Conference_A",
                                                                                                "Conference_B",
                                                                                                "Expected")]
      
      Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_A"] <- if_else(Conf_Round_1[nrow(Conf_Round_1) , "Rand"] <= 
                                                              Conf_Round_1[nrow(Conf_Round_1) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_1[nrow(Conf_Round_1) , "Won_B"] <- 1 - Conf_Round_1[ nrow(Conf_Round_1) , "Won_A"]
      
    }
    
    Conf_Round_1_Winner <- summarise(Conf_Round_1,
                                     "Wins_A" = sum(Won_A),
                                     "Wins_B" = sum(Won_B),
                                     "Winner" = if_else(Wins_A == 4,
                                                        "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Conf_Round_1_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Conf_Round_1_Winner <- select(Conf_Round_1,
                                  contains(Winner_Suffix))
    
    Conf_Round_1_Winner <- Conf_Round_1_Winner[nrow(Conf_Round_1_Winner), ]
    
    colnames(Conf_Round_1_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Conference_Round_2
  
  Conf_Round_2 <- rbind(Second_Round_3_Winner,
                        Second_Round_4_Winner)
  
  Conf_Round_2[ , "Won"] <- NA
  
  Conf_Round_2 <- transmute(Conf_Round_2,
                            Team_A = Team[1],
                            Team_B = Team[2],
                            Rating_A = Rating[1],
                            Rating_B = Rating[2],
                            Conference_A = Conference[1],
                            Conference_B = Conference[2])[1 , ]
  
  Conf_Round_2 <- mutate(Conf_Round_2,
                         Expected = (1 / 
                                       (1 + 10^(-(Rating_A - Rating_B) / 400))),
                         "Rand" = NA,
                         "Won_A" = NA,
                         "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_A"] <- if_else(Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <= 
                                                              Conf_Round_2[nrow(Conf_Round_2) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_B"] <- 1 - Conf_Round_2[ , "Won_A"]
      
    }
    
    if (sum(Conf_Round_2[ , "Won_A"], na.rm = T) == 4 || sum(Conf_Round_2[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Conf_Round_2[nrow(Conf_Round_2)+1 , c("Team_A",
                                            "Team_B",
                                            "Rating_A",
                                            "Rating_B",
                                            "Conference_A",
                                            "Conference_B",
                                            "Expected")] <- Conf_Round_2[nrow(Conf_Round_2) , c("Team_A",
                                                                                                "Team_B",
                                                                                                "Rating_A",
                                                                                                "Rating_B",
                                                                                                "Conference_A",
                                                                                                "Conference_B",
                                                                                                "Expected")]
      
      Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <- runif(1, 0, 1)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_A"] <- if_else(Conf_Round_2[nrow(Conf_Round_2) , "Rand"] <= 
                                                              Conf_Round_2[nrow(Conf_Round_2) , "Expected"],
                                                            true = 1,
                                                            false = 0)
      
      Conf_Round_2[nrow(Conf_Round_2) , "Won_B"] <- 1 - Conf_Round_2[ nrow(Conf_Round_2) , "Won_A"]
      
    }
    
    Conf_Round_2_Winner <- summarise(Conf_Round_2,
                                     "Wins_A" = sum(Won_A),
                                     "Wins_B" = sum(Won_B),
                                     "Winner" = if_else(Wins_A == 4,
                                                        "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Conf_Round_2_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Conf_Round_2_Winner <- select(Conf_Round_2,
                                  contains(Winner_Suffix))
    
    Conf_Round_2_Winner <- Conf_Round_2_Winner[nrow(Conf_Round_2_Winner), ]
    
    colnames(Conf_Round_2_Winner) <- c("Team", "Rating", "Conference", "Won")
  }
  
  ## Conference_Round_1
  
  Stanley_Cup_Round <- rbind(Conf_Round_1_Winner,
                             Conf_Round_2_Winner)
  
  Stanley_Cup_Round[ , "Won"] <- NA
  
  Stanley_Cup_Round <- transmute(Stanley_Cup_Round,
                                 Team_A = Team[1],
                                 Team_B = Team[2],
                                 Rating_A = Rating[1],
                                 Rating_B = Rating[2],
                                 Conference_A = Conference[1],
                                 Conference_B = Conference[2])[1 , ]
  
  Stanley_Cup_Round <- mutate(Stanley_Cup_Round,
                              Expected = (1 / 
                                            (1 + 10^(-(Rating_A - Rating_B) / 400))),
                              "Rand" = NA,
                              "Won_A" = NA,
                              "Won_B" = NA)
  
  for (i in 1:7) {
    
    if (i == 1) {
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <- runif(1, 0, 1)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_A"] <- if_else(Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <= 
                                                                        Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Expected"],
                                                                      true = 1,
                                                                      false = 0)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_B"] <- 1 - Stanley_Cup_Round[ , "Won_A"]
      
    }
    
    if (sum(Stanley_Cup_Round[ , "Won_A"], na.rm = T) == 4 || sum(Stanley_Cup_Round[ , "Won_B"], na.rm = T) == 4) {
      
      break
      
    } else {
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round)+1 , c("Team_A",
                                                      "Team_B",
                                                      "Rating_A",
                                                      "Rating_B",
                                                      "Conference_A",
                                                      "Conference_B",
                                                      "Expected")] <- Stanley_Cup_Round[nrow(Stanley_Cup_Round) , c("Team_A",
                                                                                                                    "Team_B",
                                                                                                                    "Rating_A",
                                                                                                                    "Rating_B",
                                                                                                                    "Conference_A",
                                                                                                                    "Conference_B",
                                                                                                                    "Expected")]
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <- runif(1, 0, 1)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_A"] <- if_else(Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Rand"] <= 
                                                                        Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Expected"],
                                                                      true = 1,
                                                                      false = 0)
      
      Stanley_Cup_Round[nrow(Stanley_Cup_Round) , "Won_B"] <- 1 - Stanley_Cup_Round[ nrow(Stanley_Cup_Round) , "Won_A"]
      
    }
    
    Stanley_Cup_Round <- mutate(Stanley_Cup_Round,
                                Sim_No = sim_no)
    
    Stanley_Cup_Round_Winner <- summarise(Stanley_Cup_Round,
                                          "Wins_A" = sum(Won_A),
                                          "Wins_B" = sum(Won_B),
                                          "Winner" = if_else(Wins_A == 4,
                                                             "Team_A", "Team_B"))
    
    Winner_Suffix <- if_else(str_detect(Stanley_Cup_Round_Winner$Winner,
                                        "Team_A"),
                             true = "_A", false = "_B")
    
    Stanley_Cup_Round_Winner <- select(Stanley_Cup_Round,
                                       contains(Winner_Suffix))
    
    Stanley_Cup_Round_Winner <- Stanley_Cup_Round_Winner[nrow(Stanley_Cup_Round_Winner), ]
    
    Stanley_Cup_Round_Winner <- mutate(Stanley_Cup_Round_Winner,
                                       Sim_No = sim_no)
    
    colnames(Stanley_Cup_Round_Winner) <- c("Team", "Rating", "Conference", "Won", "Sim_No")
    
  }
  
  Monte_Results_Season_82 <- rbind(Monte_Results_Season_82,
                                   ungroup(Game_Monte_Sum))
  
  for (round_ind in ls()[which(str_detect(ls(), "First_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_First_Round_82 <- rbind(Monte_Results_First_Round_82,
                                        First_Round_1,
                                        First_Round_2,
                                        First_Round_3,
                                        First_Round_4,
                                        First_Round_5,
                                        First_Round_6,
                                        First_Round_7,
                                        First_Round_8)
  
  for (round_ind in ls()[which(str_detect(ls(), "Second_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_Second_Round_82 <- rbind(Monte_Results_Second_Round_82,
                                         Second_Round_1,
                                         Second_Round_2,
                                         Second_Round_3,
                                         Second_Round_4)
  
  for (round_ind in ls()[which(str_detect(ls(), "Conf_Round_\\d$"))] ) {
    
    temp <- get(round_ind)
    
    temp <- mutate(temp,
                   Sim_No = sim_no)
    
    assign(round_ind, temp)
    
  }
  
  Monte_Results_Conf_Round_82 <- rbind(Monte_Results_Conf_Round_82,
                                       Conf_Round_1,
                                       Conf_Round_2)
  
  Monte_Results_Stanley_Round_82 <- rbind(Monte_Results_Stanley_Round_82,
                                          Stanley_Cup_Round)
  
  Monte_Results_Stanley_Round_Winner_82 <- rbind(Monte_Results_Stanley_Round_Winner_82,
                                                 Stanley_Cup_Round_Winner)
  

}

ggplot(Monte_Results_Stanley_Round_Winner_82) +
  geom_bar(aes(x = Team),
           fill = "cyan",
           alpha = 0.5) +
  geom_text(aes(x = Team,
                y = ..count..,
                label = ..count..,
                hjust = -0.25),
            stat = "count") +
  scale_x_discrete("Team",
                   limits = rev(levels(as.factor(Monte_Results_Stanley_Round_Winner_82$Team)))) +
  scale_y_continuous("Number of Stanley Cup Wins",
                     labels = comma) +
  theme_minimal() +
  ggtitle(label = paste("Stanley Cup Winning Teams in",
                        comma(sim_no),
                        "Trials"),
          subtitle = "Using Elo 82 non-Partition") +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip()


```


# Discussion

## Limitations

# Conclusions

# References

National Hockey League, 2019, *Stanley Cup Playoffs*, NHL, viewed 23 June 2019, <https://www.nhl.com/stanley-cup-playoffs>    

National Hockey League, 2019, *Standings - 2018-2019*, NHL, viewed 29 June 2019, <https://www.nhl.com/standings/2018/division>

National Hockey League, 2019, *Stanley Cup Playoffs format, qualification system*, NHL, viewed 24 June 2019, <https://www.nhl.com/news/stanley-cup-playoffs-format-qualification-system/c-711015>

National Hockey League, 2019, *All-Time Stanley Cup Champions*, NHL, viewed 29 June 2019, <https://www.nhl.com/info/all-time-stanley-cup-winners>

MacDonald, R, 2018, *Fixing the NHL Points System and Re-Seeding the 2018 Stanley Cup Playoffs*, Last Word on Hockey, <https://lastwordonhockey.com/2018/04/11/fixing-the-nhl-points-system-and-re-seeding-the-2018-playoffs/>

Bardown, 2019, *With post-season clinched, the St. Louis Blues make NHL history with incredible turnaround*, Bardown, Viewed 29 June 2019, <https://www.bardown.com/the-st-louis-blues-make-nhl-history-with-incredible-turnaround-1.1282314>

Hvattum, L.M., Artnzen, H., 2010, *Using ELO ratings for match result prediction in association football*, International Journal of Forecasting, vol. 26, no. 3, pp. 460 - 470

Elo, A.E., 1978, *The rating of chessplayers, past and present*, Arco Pub

Theodore, L.,  Prochaska, C., 2018, *Introduction to Mathematical Methods for Environmental Engineers and Scientists*, John Wiley & Sons, Incorporated, Newark.

```{r echo=FALSE}

Sys.time() - start_time

beepr::beep(2)

```

